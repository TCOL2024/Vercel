<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Linda – Deine persönliche Assistentin (v27.8)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
:root{--bg:#f7f8fb;--panel:#fff;--line:#e7ebf0;--text:#0f172a;--muted:#5b6678;--brand:#0b5bd3;--brand2:#2b6ff0;--shadow:0 8px 24px rgba(15,23,42,.06),0 1px 2px rgba(15,23,42,.04)}
body.dark{--bg:#0b0e14;--panel:#0f1420;--line:#1d2535;--text:#e7eaf0;--muted:#a4b0c3;--brand:#6aa4ff;--brand2:#88b2ff}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
.top{position:sticky;top:0;z-index:30;background:var(--panel);border-bottom:1px solid var(--line);padding:.9rem 1rem;display:flex;align-items:center;gap:.75rem}
.brand{font-weight:600}
.grow{flex:1}
.icon-btn{background:transparent;border:0;cursor:pointer;padding:.4rem;border-radius:.6rem}
.icon-btn:hover{background:rgba(11,91,211,.08)}
.container{max-width:1100px;margin:0 auto;padding:1rem;display:grid;grid-template-columns:250px 1fr;gap:1rem}
.panel{background:var(--panel);border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow)}
.avatar{padding:1rem;text-align:center}
.avatar img{width:100%;border-radius:10px}
.chat{display:flex;flex-direction:column;min-height:calc(100vh - 120px)}
.log{flex:1;overflow:auto;display:flex;flex-direction:column;gap:1rem;padding:.5rem}
.bubble{max-width:78ch;border-radius:12px;padding:1rem;background:var(--panel);box-shadow:var(--shadow)}
.me{align-self:flex-end;background:var(--brand);color:#fff}
.composer{display:flex;gap:.5rem;align-items:center;padding:.6rem;background:var(--panel);border:1px solid var(--line);border-radius:12px;position:sticky;bottom:0}
.in{flex:1;border:1px solid var(--line);border-radius:10px;padding:.8rem;background:color-mix(in oklab,var(--panel) 80%,var(--bg));font-size:1rem;color:var(--text)}
.send{border:0;background:var(--brand);color:#fff;font-weight:600;border-radius:10px;padding:.7rem 1rem;cursor:pointer}
.send:disabled{opacity:.6;cursor:not-allowed}
/* modal */
.modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(17,24,39,.32);backdrop-filter:saturate(140%) blur(6px);z-index:1000}
.card{background:var(--panel);border:1px solid var(--line);border-radius:16px;box-shadow:var(--shadow);width:min(92vw,500px);max-height:85vh;overflow:auto}
.card-h{padding:1rem 1.2rem;border-bottom:1px solid var(--line);font-weight:600}
.card-b{padding:1rem 1.2rem}
.card-f{padding:1rem 1.2rem;border-top:1px solid var(--line);display:flex;justify-content:flex-end;gap:.6rem}
.btn{border:1px solid var(--line);background:color-mix(in oklab,var(--panel) 80%,var(--bg));color:var(--brand);border-radius:.7rem;padding:.55rem .9rem;cursor:pointer;font-weight:600}
.btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
.row{display:flex;align-items:center;justify-content:space-between;margin:.6rem 0}
.switch{width:46px;height:26px;border-radius:999px;background:#dfe6f3;position:relative;cursor:pointer;border:1px solid var(--line)}
.switch>i{position:absolute;width:22px;height:22px;top:1px;left:1px;border-radius:50%;background:#fff;transition:left .18s}
.switch.on{background:#bcd4ff}.switch.on>i{left:23px}
</style>
</head>
<body>

<div class="top">
  <div class="brand">Linda</div>
  <div class="grow"></div>
  <button class="icon-btn" id="btn-settings" aria-label="Einstellungen öffnen">
    ⚙️
  </button>
</div>

<div class="container">
  <aside class="panel avatar">
    <img src="https://ntc-bot1.netlify.app/Bildschirmfoto%202025-06-26%20um%2021.09.25.png" alt="Linda"/>
    <div class="name">Linda</div>
  </aside>

  <section class="chat">
    <div id="log" class="log"></div>
    <div class="composer">
      <input id="in" class="in" placeholder="Deine Frage…">
      <button id="send" class="send">Senden</button>
    </div>
  </section>
</div>

<!-- Einstellungen -->
<div id="m-settings" class="modal">
  <div class="card">
    <div class="card-h">Einstellungen</div>
    <div class="card-b">
      <div class="row">
        <label>Dark Mode</label><div id="sw-theme" class="switch"><i></i></div>
      </div>
      <div class="row">
        <label>Gender-Sprache</label><div id="sw-gender" class="switch"><i></i></div>
      </div>
    </div>
    <div class="card-f">
      <button class="btn" id="s-close">Schließen</button>
      <button class="btn primary" id="s-save">Speichern</button>
    </div>
  </div>
</div>

<script>
(function(){
const $=id=>document.getElementById(id);
const LS={get(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}},set(k,v){localStorage.setItem(k,JSON.stringify(v))}};
let S=LS.get('linda.settings',{theme:'light',gender:false});
let Sessions=LS.get('linda.sessions',[{id:'s1',name:'Neuer Chat',ts:Date.now(),messages:[]}]);
function save(){LS.set('linda.settings',S);LS.set('linda.sessions',Sessions);}
function active(){return Sessions[0];}
function md(t){try{return marked.parse(t)}catch{return t};}
function addMsg(role,c){const d=document.createElement('div');d.className='bubble'+(role==='user'?' me':'');d.innerHTML='<div class="md">'+md(c)+'</div>';$('log').appendChild(d);$('log').scrollTop=$('log').scrollHeight;}
function render(){ $('log').innerHTML=''; active().messages.forEach(m=>addMsg(m.role,m.content)); }
function systemPrefix(){ return (S.gender?'Verwende gendergerechte Sprache (neutral, inklusiv, gut lesbar).':'Verwende neutrale, nicht gegenderte Sprache.'); }

async function send(){
 const inp=$('in'); const q=inp.value.trim(); if(!q)return;
 inp.value=''; $('send').disabled=true;
 active().messages.push({role:'user',content:q}); render();
 active().messages.push({role:'assistant',content:'⏳ Einen Moment …'}); render();
 try{
   const payload={question:"Systemanweisung:\n"+systemPrefix()+"\n\nNutzerfrage:\n"+q};
   const r=await fetch('/api/bot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
   const text=await r.text();
   const out=(text&&text.trim().toLowerCase()!=='accepted')?text:'Keine Antwort empfangen.';
   active().messages[active().messages.length-1]={role:'assistant',content:out};
   save(); render();
 }catch(e){
   active().messages[active().messages.length-1]={role:'assistant',content:'Verbindungsfehler.'};
   render();
 }finally{$('send').disabled=false;}
}

// --- Settings Modal ---
function show(m){m.style.display='flex'} function hide(m){m.style.display='none'}
function sw(el,val){el.classList.toggle('on',val)}
function applyTheme(){document.body.classList.toggle('dark',S.theme==='dark');}
$('btn-settings').onclick=()=>{sw($('sw-theme'),S.theme==='dark');sw($('sw-gender'),S.gender);show($('m-settings'));}
$('s-close').onclick=()=>hide($('m-settings'));
$('sw-theme').onclick=()=>{S.theme=S.theme==='dark'?'light':'dark';sw($('sw-theme'),S.theme==='dark');applyTheme();}
$('sw-gender').onclick=()=>{S.gender=!S.gender;sw($('sw-gender'),S.gender);}
$('s-save').onclick=()=>{save();hide($('m-settings'));addMsg('assistant',S.gender?'Ich verwende gendergerechte Sprache.':'Ich verwende neutrale Sprache.');}
applyTheme();

$('send').onclick=send;
$('in').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();}});
render();
})();
</script>
</body>
</html>

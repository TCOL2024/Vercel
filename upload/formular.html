<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <title>Dokumenten-Upload ¬∑ OneDrive via Make</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="color-scheme" content="light dark">
  <style>
    :root{
      --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#94a3b8; --border:#1f2a44;
      --accent:#7c3aed; --accent-2:#2563eb; --ok:#10b981; --err:#ef4444; --hint:#334155
    }
    @media (prefers-color-scheme: light){
      :root{ --bg:#f6f7fb; --panel:#ffffff; --ink:#0f1720; --muted:#5b6673; --border:#e6e8f0; --hint:#eef2f7 }
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(135deg,var(--hint),transparent 40%) fixed, var(--bg);
         font:16px/1.45 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,sans-serif; color:var(--ink)}
    .wrap{max-width:880px;margin:40px auto;padding:20px}
    .card{background:var(--panel);border:1px solid var(--border);border-radius:18px;padding:24px;
          box-shadow:0 6px 32px rgba(0,0,0,.12)}
    h1{margin:0 0 8px;font-size:24px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    .grid{display:grid;gap:16px;grid-template-columns:1fr}
    @media(min-width:720px){ .grid{grid-template-columns:1fr 1fr} }

    .drop{border:2px dashed var(--border);border-radius:14px;padding:26px;text-align:center;background:var(--hint)}
    .drop.drag{border-color:var(--accent); background-color:rgba(124,58,237,.08)}
    .drop strong{display:block;margin-bottom:8px}
    .drop small{color:var(--muted)}

    label{display:block;font-weight:600;margin:6px 0 8px}
    input[type="text"],input[type="password"]{
      width:100%;padding:12px;border:1px solid var(--border);border-radius:10px;background:transparent;color:var(--ink)
    }
    input::placeholder{color:#9aa6b2}
    .files{margin-top:10px;border:1px dashed var(--border);border-radius:12px;padding:10px;max-height:220px;overflow:auto;background:rgba(0,0,0,.03)}
    .file{display:flex;justify-content:space-between;gap:12px;padding:8px 10px;border-radius:10px}
    .file + .file{margin-top:6px}
    .file .meta{font-size:14px}
    .file .meta small{color:var(--muted)}
    .file .act{display:flex;align-items:center;gap:10px}
    .file .rm{background:transparent;border:1px solid var(--border);color:var(--muted);padding:6px 10px;border-radius:8px;cursor:pointer}

    .bar{margin-top:16px;height:10px;border-radius:999px;background:rgba(0,0,0,.08);overflow:hidden;display:none}
    .bar > span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--accent-2))}
    .hint{margin-top:8px;color:var(--muted);font-size:14px}

    .actions{display:flex;gap:12px;margin-top:16px;flex-wrap:wrap}
    .btn{appearance:none;border:0;border-radius:12px;padding:12px 16px;cursor:pointer;font-weight:700}
    .primary{background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff}
    .ghost{background:transparent;border:1px solid var(--border);color:var(--ink)}

    .note{margin-top:14px;padding:10px;border-radius:10px;background:rgba(16,185,129,.12);color:#047857;display:none}
    .err{margin-top:14px;padding:10px;border-radius:10px;background:rgba(239,68,68,.12);color:#b91c1c;display:none}

    .kbd{font-family:ui-monospace,Consolas,monospace;font-size:12px;padding:2px 6px;border-radius:6px;background:rgba(0,0,0,.08)}
    footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:right}
    /* Hide the raw file input ‚Äì click on the drop zone instead */
    #file{display:none}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üì§ Dokumenten-Upload nach OneDrive</h1>
      <p class="lead">Eleganter Drag&Drop-Upload. L√§uft √ºber deinen Make-Webhook (multipart/form-data, kein CORS-Stress).</p>

      <!-- Hidden iframe als Ziel f√ºr den klassischen Form-POST -->
      <iframe name="silentTarget" style="display:none" id="silentTarget"></iframe>

      <!-- Formular: klassischer POST ins iframe -->
      <form id="uplForm" action="ACTION_WEBHOOK_URL" method="POST" enctype="multipart/form-data" target="silentTarget">
        <div class="grid">
          <section>
            <label>Datei(en)</label>
            <div id="drop" class="drop" tabindex="0" role="button" aria-label="Datei hier ablegen oder klicken">
              <strong>Ziehen & ablegen oder klicken</strong>
              <small>Erlaubte Typen: HTML, PDF, PNG, JPG, DOCX ‚Ä¢ Max. 15 MB je Datei</small>
              <input id="file" name="file" type="file" multiple>
            </div>
            <div id="files" class="files" hidden></div>
          </section>

          <section>
            <label>Ziel-Dateiname (optional, bei Einzeldokument)</label>
            <input id="target_name" name="target_name" type="text" placeholder="z. B. handout.html">
            <label style="margin-top:14px">Secret (optional, empfohlen)</label>
            <input id="token" name="token" type="password" autocomplete="off" placeholder="z. B. UPL-SECRET-123">
            <p class="hint">Tipp: Im Webhook einen Filter <span class="kbd">token == ‚Ä¶</span> setzen.</p>
          </section>
        </div>

        <div class="bar" id="bar"><span id="barIn"></span></div>

        <div class="actions">
          <button type="button" class="btn ghost" id="pickBtn">Datei ausw√§hlen</button>
          <button class="btn primary" id="sendBtn">Hochladen</button>
          <button type="reset" class="btn ghost">Zur√ºcksetzen</button>
        </div>

        <div id="ok" class="note">‚úÖ Upload gestartet ‚Äì Ergebnis kommt gleich zur√ºck.</div>
        <div id="err" class="err">‚ùå Bitte w√§hle mindestens eine g√ºltige Datei.</div>
      </form>

      <footer>
        <span class="kbd">Form POST</span> ¬∑ Falls mehrere Dateien gew√§hlt: Make nutzt <span class="kbd">file[1], file[2], ‚Ä¶</span>
      </footer>
    </div>
  </div>

  <script>
    // ============ Konfiguration ============
    const MAX_MB = 15;
    const ALLOWED = [
      "text/html","application/pdf","image/png","image/jpeg",
      "application/vnd.openxmlformats-officedocument.wordprocessingml.document"
    ];
    // =======================================

    const drop = document.getElementById('drop');
    const fileInput = document.getElementById('file');
    const filesBox = document.getElementById('files');
    const sendBtn = document.getElementById('sendBtn');
    const pickBtn = document.getElementById('pickBtn');
    const ok = document.getElementById('ok');
    const err = document.getElementById('err');
    const bar = document.getElementById('bar');
    const barIn = document.getElementById('barIn');
    const form = document.getElementById('uplForm');
    const iframe = document.getElementById('silentTarget');

    function fmt(n){ return (n/1024/1024).toFixed(2) + " MB"; }

    // Drag & Drop UX
    function prevent(e){ e.preventDefault(); e.stopPropagation(); }
    ['dragenter','dragover'].forEach(ev => drop.addEventListener(ev, e => {
      prevent(e); drop.classList.add('drag');
    }));
    ['dragleave','drop'].forEach(ev => drop.addEventListener(ev, e => {
      prevent(e); drop.classList.remove('drag');
    }));
    drop.addEventListener('click', () => fileInput.click());
    drop.addEventListener('drop', e => {
      const list = e.dataTransfer.files;
      if(list && list.length){ fileInput.files = list; renderList(); }
    });
    fileInput.addEventListener('change', renderList);
    pickBtn.addEventListener('click', () => fileInput.click());

    function renderList(){
      err.style.display = 'none';
      filesBox.innerHTML = '';
      const list = fileInput.files;
      if(!list || !list.length){ filesBox.hidden = true; return; }
      [...list].forEach((f, i) => {
        const el = document.createElement('div');
        el.className = 'file';
        el.innerHTML = `
          <div class="meta">üìÑ <strong>${f.name}</strong><br><small>${f.type || 'unbekannt'} ‚Ä¢ ${fmt(f.size)}</small></div>
          <div class="act"><button type="button" class="rm" data-i="${i}">Entfernen</button></div>`;
        filesBox.appendChild(el);
      });
      filesBox.hidden = false;
      filesBox.querySelectorAll('.rm').forEach(btn => btn.addEventListener('click', (e)=>{
        const i = +e.currentTarget.dataset.i;
        const dt = new DataTransfer();
        [...fileInput.files].forEach((f, idx) => { if(idx !== i) dt.items.add(f); });
        fileInput.files = dt.files;
        renderList();
      }));
      // Wenn genau 1 Datei und kein custom Name gesetzt ‚Üí vorschlagen
      const tn = document.getElementById('target_name');
      if(list.length === 1 && !tn.value) tn.value = list[0].name;
    }

    // Validierung
    function validate(){
      const list = fileInput.files;
      if(!list || !list.length) return { ok:false, msg:"Keine Datei ausgew√§hlt." };
      for(const f of list){
        if(f.size > MAX_MB * 1024 * 1024) return { ok:false, msg:`${f.name}: gr√∂√üer als ${MAX_MB} MB.` };
        if(ALLOWED.length && !ALLOWED.includes(f.type)){
          // HTML mit leerem type zulassen
          const isHtmlByName = /\.html?$/i.test(f.name);
          if(!(isHtmlByName && (!f.type || f.type === 'text/html'))) {
            return { ok:false, msg:`${f.name}: Dateityp nicht erlaubt (${f.type||'unbekannt'}).` };
          }
        }
      }
      return { ok:true };
    }

    // Upload-Ablauf (klassischer Form-POST ins hidden iframe)
    form.addEventListener('submit', (e)=>{
      const v = validate();
      if(!v.ok){
        e.preventDefault();
        err.textContent = '‚ùå ' + v.msg;
        err.style.display = 'block';
        return;
      }
      // Simple "Fake"-Progress (da klassischer Form POST, kein echter Stream-Progress)
      bar.style.display = 'block'; barIn.style.width = '15%';
      ok.style.display = 'block'; err.style.display = 'none';
      let p = 15;
      const t = setInterval(()=>{ p = Math.min(p+7, 90); barIn.style.width = p + '%'; }, 180);

      // Wenn das iframe l√§dt (Response von Make), werten wir das als fertig
      const onDone = ()=>{
        clearInterval(t);
        barIn.style.width = '100%';
        setTimeout(()=>{ bar.style.display='none'; barIn.style.width='0%'; }, 600);
        setTimeout(()=>{ ok.style.display='none'; }, 2500);
        iframe.removeEventListener('load', onDone);
        // Optional: Formular zur√ºcksetzen
        // form.reset(); filesBox.hidden = true; filesBox.innerHTML='';
      };
      iframe.addEventListener('load', onDone);
    });
  </script>
</body>
</html>

<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SprachKi – Textübersetzung (DeepL)</title>

  <style>
    :root{
      --bg:#0b1220;
      --card:#121a2b;
      --text:#e8eefc;
      --muted:#93a4c7;
      --line:rgba(255,255,255,.12);
      --accent:#4aa3ff;
      --ok:#57d39c;
      --danger:#ff5a6a;
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
      --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:var(--sans);
      background:var(--bg);
      color:var(--text);
    }

    .wrap{max-width:1100px;margin:0 auto;padding:24px}

    header{
      display:flex;
      justify-content:space-between;
      gap:16px;
      margin-bottom:16px;
    }

    h1{font-size:18px;margin:0}
    .sub{font-size:13px;color:var(--muted);line-height:1.4}

    .status{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      max-width:520px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .status.ok{color:var(--ok);border-color:rgba(87,211,156,.4)}
    .status.err{color:var(--danger);border-color:rgba(255,90,106,.4)}

    .bar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      padding:12px;
      border-radius:var(--radius);
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
    }

    select,button{
      font:inherit;
      color:var(--text);
      background:rgba(255,255,255,.06);
      border:1px solid var(--line);
      border-radius:12px;
      padding:10px 12px;
    }

    button{
      cursor:pointer;
      background:linear-gradient(180deg, rgba(74,163,255,.25), rgba(74,163,255,.1));
      border-color:rgba(74,163,255,.35);
    }
    button:disabled{opacity:.5;cursor:not-allowed}

    .hint{font-size:12px;color:var(--muted)}

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
      margin-top:14px;
    }

    .card{
      display:flex;
      flex-direction:column;
      min-height:360px;
      background:rgba(255,255,255,.04);
      border:1px solid var(--line);
      border-radius:var(--radius);
      overflow:hidden;
    }

    .card h2{
      margin:0;
      padding:12px 14px;
      font-size:13px;
      border-bottom:1px solid var(--line);
      display:flex;
      justify-content:space-between;
    }

    textarea{
      flex:1;
      width:100%;
      border:0;
      outline:none;
      resize:none;
      padding:14px;
      background:transparent;
      color:var(--text);
      font-size:14px;
      line-height:1.5;
    }

    .footer{
      padding:10px 14px;
      border-top:1px solid var(--line);
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
    }

    .panel{
      margin-top:14px;
      padding:12px 14px;
      border-radius:var(--radius);
      border:1px dashed rgba(255,255,255,.25);
      background:rgba(255,255,255,.03);
      font-size:12px;
      line-height:1.45;
      color:var(--muted);
      display:none;
    }

    @media(max-width:900px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
<div class="wrap">

  <header>
    <div>
      <h1>SprachKi – Textübersetzung</h1>
      <div class="sub">
        Text einfügen (max. <b>1000 Zeichen</b>) → DeepL-Übersetzung.<br>
        Deine Daten werden an deepl übermittelt.
      </div>
    </div>
    <div class="status" id="status">Bereit</div>
  </header>

  <div class="bar">
    <label class="hint">
      Zielsprache:
      <select id="targetLang">
        <option value="DE">Deutsch</option>
        <option value="EN-GB">Englisch (UK)</option>
        <option value="EN-US">Englisch (US)</option>
        <option value="FR">Französisch</option>
        <option value="ES">Spanisch</option>
        <option value="IT">Italienisch</option>
        <option value="NL">Niederländisch</option>
        <option value="PL">Polnisch</option>
      </select>
    </label>

    <button id="runBtn">Übersetzen</button>
    <span class="hint">Aktive Anbindung vorhanden an deepl</code></span>
  </div>

  <div class="panel" id="helpPanel"></div>

  <div class="grid">
    <section class="card">
      <h2>
        <span>Eingabetext</span>
        <span id="count">0 / 1000</span>
      </h2>
      <textarea id="input" placeholder="Text hier einfügen …"></textarea>
      <div class="footer">Maximal 1000 Zeichen.</div>
    </section>

    <section class="card">
      <h2>
        <span>Übersetzung</span>
        <span id="latency">—</span>
      </h2>
      <textarea id="output" readonly placeholder="Übersetzter Text …"></textarea>
      <div class="footer">DeepL-Ergebnis</div>
    </section>
  </div>

</div>

<script>
const MAX = 1000;
const input = document.getElementById("input");
const output = document.getElementById("output");
const count = document.getElementById("count");
const status = document.getElementById("status");
const help = document.getElementById("helpPanel");
const latency = document.getElementById("latency");

input.addEventListener("input", () => {
  if(input.value.length > MAX){
    input.value = input.value.slice(0, MAX);
  }
  count.textContent = input.value.length + " / " + MAX;
});

document.getElementById("runBtn").onclick = async () => {
  const text = input.value.trim();
  if(!text){
    status.textContent = "Bitte Text eingeben";
    status.className = "status err";
    return;
  }

  status.textContent = "Übersetze …";
  status.className = "status";

  help.style.display = "none";
  output.value = "";

  const t0 = performance.now();

  try{
    const res = await fetch("/api/translate", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body:JSON.stringify({
        text,
        target_lang: document.getElementById("targetLang").value
      })
    });

    const data = await res.json();
    latency.textContent = Math.round(performance.now() - t0) + " ms";

    if(!res.ok){
      if(data.error?.includes("missing DEEPL_API_KEY")){
        help.innerHTML = `
          <b>Server nicht konfiguriert</b><br>
          In Vercel ist die Environment Variable <code>DEEPL_API_KEY</code> nicht gesetzt.<br><br>
          <b>Lösung:</b>
          <ol>
            <li>Vercel → Project → Settings → Environment Variables</li>
            <li><code>DEEPL_API_KEY</code> anlegen</li>
            <li>Redeploy durchführen</li>
          </ol>
        `;
        help.style.display = "block";
      }
      throw new Error(data.error || "Serverfehler");
    }

    output.value = data.result || "";
    status.textContent = "Fertig";
    status.className = "status ok";

  }catch(e){
    status.textContent = "Fehler: " + e.message;
    status.className = "status err";
  }
};
</script>

</body>
</html>

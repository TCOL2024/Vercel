<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SprachKi</title>

  <style>
    :root{
      --bg:#ffffff;
      --text:#0f172a;
      --muted:#475569;

      --line:#cfe3ff;
      --line-strong:#89b6ff;

      --accent:#1d4ed8;
      --accent-soft:#eaf2ff;

      --ok:#0f766e;
      --danger:#b91c1c;

      --shadow: 0 10px 30px rgba(2, 6, 23, 0.06);
      --radius:16px;

      --sans: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial;

      --tap: 44px;           /* Touch-Zielgröße */
      --pad: 14px;           /* Standard-Padding */
      --font: 16px;          /* Mobil gut lesbar */
      --lh: 1.55;
    }

    *{box-sizing:border-box}

    body{
      margin:0;
      font-family:var(--sans);
      font-size:var(--font);
      line-height:var(--lh);
      color:var(--text);
      background:
        radial-gradient(900px 520px at 20% -10%, rgba(29,78,216,.10), transparent 60%),
        radial-gradient(700px 420px at 90% 10%, rgba(29,78,216,.08), transparent 55%),
        var(--bg);
    }

    .wrap{max-width:1120px;margin:0 auto;padding:20px}

    header{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:12px;
      margin-bottom:16px;
    }

    .brand{display:flex;align-items:center;gap:10px}
    .logo{
      width:36px;height:36px;border-radius:14px;
      background: linear-gradient(180deg, rgba(29,78,216,.18), rgba(29,78,216,.06));
      border:1px solid var(--line);
      display:grid;place-items:center;
      box-shadow: 0 6px 18px rgba(29,78,216,.12);
      color:var(--accent);
      font-weight:900;
      user-select:none;
    }

    h1{font-size:18px;margin:0;letter-spacing:.2px}
    .sub{font-size:13px;color:var(--muted);margin-top:3px}

    .status{
      font-size:12px;
      padding:7px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.85);
      color:var(--muted);
      max-width:520px;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
    }
    .status.ok{border-color:rgba(15,118,110,.25); color:var(--ok); background:rgba(15,118,110,.06)}
    .status.err{border-color:rgba(185,28,28,.25); color:var(--danger); background:rgba(185,28,28,.06)}

    /* Accordion via <details> */
    .acc{
      border:1px solid var(--line);
      border-radius:var(--radius);
      background:rgba(255,255,255,.90);
      box-shadow:var(--shadow);
      overflow:hidden;
      margin-bottom:12px;
    }

    .acc summary{
      list-style:none;
      cursor:pointer;
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: linear-gradient(180deg, rgba(234,242,255,.90), rgba(255,255,255,.75));
      border-bottom:1px solid var(--line);
      user-select:none;
      min-height: var(--tap);
    }
    .acc summary::-webkit-details-marker{display:none}

    .accTitle{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .accTitle b{font-size:14px}
    .accTitle span{font-size:12px;color:var(--muted)}

    .chev{
      width:36px;height:36px;border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      display:grid;place-items:center;
      color:var(--accent);
      font-weight:900;
      flex:0 0 auto;
    }
    .acc[open] .chev{transform: rotate(180deg)}
    .acc[open] summary{border-bottom-color: var(--line-strong)}

    /* Inner layout: links Input, rechts Ergebnis */
    .panel{
      padding:14px;
      background:rgba(255,255,255,.72);
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:12px;
    }

    .card{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:320px;
    }

    .cardHead{
      padding:12px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      background:rgba(234,242,255,.55);
      border-bottom:1px solid var(--line);
      min-height: var(--tap);
    }

    .label{font-weight:800;font-size:13px}
    .meta{font-size:12px;color:var(--muted)}

    textarea{
      width:100%;
      flex:1;
      border:0;
      outline:none;
      resize:none;
      padding:12px;
      font-size:16px;
      line-height:1.55;
      color:var(--text);
      background:#fff;
    }
    textarea::placeholder{color:#94a3b8}

    .foot{
      border-top:1px solid var(--line);
      padding:10px 12px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      background:rgba(255,255,255,.86);
      font-size:12px;
      color:var(--muted);
    }

    .btnRow{display:flex;gap:8px;flex-wrap:wrap}

    button, select{
      font:inherit;
      border-radius:12px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      padding:10px 12px;
      min-height: var(--tap);
    }

    button{
      cursor:pointer;
      border-color: rgba(29,78,216,.28);
      background: linear-gradient(180deg, rgba(29,78,216,.12), rgba(29,78,216,.06));
      color: var(--accent);
      font-weight:800;
    }
    button:hover{border-color: rgba(29,78,216,.42)}
    button:disabled{opacity:.55;cursor:not-allowed}

    .ghost{
      border-color: var(--line);
      background:#fff;
      color: var(--muted);
      font-weight:800;
    }

    .iconBtn{
      border:1px solid var(--line);
      background:#fff;
      color:var(--accent);
      font-weight:900;
      padding:8px 10px;
      min-height: var(--tap);
    }

    .rightTools{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
    }

    .hint{
      display:flex;
      align-items:center;
      gap:8px;
    }
    .dot{
      width:8px;height:8px;border-radius:99px;
      background:var(--accent-soft);
      border:1px solid var(--line);
    }

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr} /* mobil: untereinander */
      .card{min-height:300px}
      .wrap{padding:16px}
      textarea{font-size:16px} /* iOS zoom vermeiden */
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <div>
        <div class="brand">
          <div class="logo">S</div>
          <div>
            <h1>SprachKi</h1>
            <div class="sub">Drei Werkzeuge – klare Eingabe links, Ergebnis rechts.</div>
          </div>
        </div>
      </div>
      <div class="status" id="status">Bereit</div>
    </header>

    <!-- 1) Sprach-KI (Umformulieren) -->
    <details class="acc" id="acc-rewrite">
      <summary>
        <div class="accTitle">
          <b>Sprach-KI</b>
          <span>Text umformulieren – Stil auswählen, Ergebnis kopieren.</span>
        </div>
        <div class="chev">⌄</div>
      </summary>

      <div class="panel">
        <div class="grid">

          <!-- links: Aufgabe -->
          <div class="card">
            <div class="cardHead">
              <div class="label">Aufgabe</div>
              <div class="meta"><span id="cnt-rewrite">0</span>/1000</div>
            </div>
            <textarea id="in-rewrite" placeholder="Text einfügen … (max. 1000 Zeichen)"></textarea>
            <div class="foot">
              <div class="hint"><span class="dot"></span><span>Max. 1000 Zeichen</span></div>
              <div class="btnRow">
                <select id="style-rewrite" aria-label="Stil">
                  <option value="neutral" selected>Neutral / klar</option>
                  <option value="freundlich">Freundlich</option>
                  <option value="formell">Formell</option>
                  <option value="kurz">Kürzer</option>
                  <option value="besser">Besser formuliert</option>
                </select>
                <button id="send-rewrite" type="button">Senden</button>
                <button id="clear-rewrite" class="ghost" type="button">Leeren</button>
              </div>
            </div>
          </div>

          <!-- rechts: Ergebnis -->
          <div class="card">
            <div class="cardHead">
              <div class="label">Ergebnis</div>
              <div class="rightTools">
                <div class="meta" id="ms-rewrite">—</div>
                <button id="copy-rewrite" class="iconBtn" type="button" title="Kopieren" disabled>⧉</button>
                <button id="toin-rewrite" class="ghost" type="button" title="In Aufgabe übernehmen" disabled>In Aufgabe</button>
              </div>
            </div>
            <textarea id="out-rewrite" readonly placeholder="Hier erscheint das Ergebnis …"></textarea>
            <div class="foot">
              <div class="hint"><span class="dot"></span><span>Kopieren mit ⧉</span></div>
              <span></span>
            </div>
          </div>

        </div>
      </div>
    </details>

    <!-- 2) Übersetzer -->
    <details class="acc" id="acc-translate">
      <summary>
        <div class="accTitle">
          <b>Übersetzer</b>
          <span>Text übersetzen – Ziel auswählen, Ergebnis kopieren.</span>
        </div>
        <div class="chev">⌄</div>
      </summary>

      <div class="panel">
        <div class="grid">

          <!-- links: Frage -->
          <div class="card">
            <div class="cardHead">
              <div class="label">Frage / Text</div>
              <div class="meta"><span id="cnt-translate">0</span>/1000</div>
            </div>
            <textarea id="in-translate" placeholder="Text einfügen … (max. 1000 Zeichen)"></textarea>
            <div class="foot">
              <div class="hint"><span class="dot"></span><span>Max. 1000 Zeichen</span></div>
              <div class="btnRow">
                <select id="lang-translate" aria-label="Zielsprache">
                  <option value="DE">Deutsch</option>
                  <option value="EN-GB">Englisch (UK)</option>
                  <option value="EN-US">Englisch (US)</option>
                  <option value="FR">Französisch</option>
                  <option value="ES">Spanisch</option>
                  <option value="IT">Italienisch</option>
                  <option value="NL">Niederländisch</option>
                  <option value="PL">Polnisch</option>
                </select>
                <button id="send-translate" type="button">Senden</button>
                <button id="clear-translate" class="ghost" type="button">Leeren</button>
              </div>
            </div>
          </div>

          <!-- rechts: Ergebnis -->
          <div class="card">
            <div class="cardHead">
              <div class="label">Ergebnis</div>
              <div class="rightTools">
                <div class="meta" id="ms-translate">—</div>
                <button id="copy-translate" class="iconBtn" type="button" title="Kopieren" disabled>⧉</button>
                <button id="toin-translate" class="ghost" type="button" title="In Frage übernehmen" disabled>In Frage</button>
                <button id="to-rewrite" class="ghost" type="button" title="In Sprach-KI übernehmen" disabled>→ Sprach-KI</button>
              </div>
            </div>
            <textarea id="out-translate" readonly placeholder="Hier erscheint das Ergebnis …"></textarea>
            <div class="foot">
              <div class="hint"><span class="dot"></span><span>Kopieren mit ⧉</span></div>
              <span></span>
            </div>
          </div>

        </div>
      </div>
    </details>

    <!-- 3) Allgemeine Wissensfragen -->
    <details class="acc" id="acc-ask">
      <summary>
        <div class="accTitle">
          <b>Allgemeine Wissensfragen</b>
          <span>Frage stellen – Antwort erhalten – kopieren.</span>
        </div>
        <div class="chev">⌄</div>
      </summary>

      <div class="panel">
        <div class="grid">

          <!-- links: Frage -->
          <div class="card">
            <div class="cardHead">
              <div class="label">Frage</div>
              <div class="meta"><span id="cnt-ask">0</span>/1000</div>
            </div>
            <textarea id="in-ask" placeholder="Frage eingeben … (max. 1000 Zeichen)"></textarea>
            <div class="foot">
              <div class="hint"><span class="dot"></span><span>Max. 1000 Zeichen</span></div>
              <div class="btnRow">
                <button id="send-ask" type="button">Senden</button>
                <button id="clear-ask" class="ghost" type="button">Leeren</button>
              </div>
            </div>
          </div>

          <!-- rechts: Antwort -->
          <div class="card">
            <div class="cardHead">
              <div class="label">Antwort</div>
              <div class="rightTools">
                <div class="meta" id="ms-ask">—</div>
                <button id="copy-ask" class="iconBtn" type="button" title="Kopieren" disabled>⧉</button>
                <button id="toin-ask" class="ghost" type="button" title="In Frage übernehmen" disabled>In Frage</button>
              </div>
            </div>
            <textarea id="out-ask" readonly placeholder="Hier erscheint die Antwort …"></textarea>
            <div class="foot">
              <div class="hint"><span class="dot"></span><span>Kopieren mit ⧉</span></div>
              <span></span>
            </div>
          </div>

        </div>
      </div>
    </details>

  </div>

<script>
  const MAX = 1000;
  const statusEl = document.getElementById("status");

  function setStatus(text, kind="") {
    statusEl.textContent = text;
    statusEl.className = "status" + (kind ? (" " + kind) : "");
  }

  function clampAndCount(textarea, countEl) {
    if (textarea.value.length > MAX) textarea.value = textarea.value.slice(0, MAX);
    countEl.textContent = String(textarea.value.length);
  }

  async function copyText(text, btn) {
    if (!text) return;
    try {
      await navigator.clipboard.writeText(text);
      const old = btn.textContent;
      btn.textContent = "✓";
      setStatus("Kopiert", "ok");
      setTimeout(() => { btn.textContent = old; setStatus("Bereit"); }, 900);
    } catch {
      setStatus("Kopieren nicht möglich", "err");
    }
  }

  function enable(btn, on=true){ btn.disabled = !on; }

  function putInto(text, textarea, countEl) {
    textarea.value = (text || "").slice(0, MAX);
    clampAndCount(textarea, countEl);
    textarea.focus();
  }

  async function postJSON(url, payload) {
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json().catch(() => ({}));
    if (!res.ok) throw new Error(data.error || "Serverfehler");
    return data;
  }

  // --- REWRITE ---
  const inRewrite = document.getElementById("in-rewrite");
  const outRewrite = document.getElementById("out-rewrite");
  const cntRewrite = document.getElementById("cnt-rewrite");
  const msRewrite = document.getElementById("ms-rewrite");
  const styleRewrite = document.getElementById("style-rewrite");
  const sendRewrite = document.getElementById("send-rewrite");
  const clearRewrite = document.getElementById("clear-rewrite");
  const copyRewrite = document.getElementById("copy-rewrite");
  const toinRewrite = document.getElementById("toin-rewrite");

  inRewrite.addEventListener("input", () => clampAndCount(inRewrite, cntRewrite));
  clampAndCount(inRewrite, cntRewrite);

  clearRewrite.onclick = () => {
    inRewrite.value = "";
    clampAndCount(inRewrite, cntRewrite);
    inRewrite.focus();
  };

  copyRewrite.onclick = () => copyText(outRewrite.value, copyRewrite);

  toinRewrite.onclick = () => putInto(outRewrite.value, inRewrite, cntRewrite);

  sendRewrite.onclick = async () => {
    const text = inRewrite.value.trim();
    if (!text) return setStatus("Bitte Text eingeben", "err");

    sendRewrite.disabled = true;
    enable(copyRewrite, false);
    enable(toinRewrite, false);
    outRewrite.value = "";
    msRewrite.textContent = "—";
    setStatus("Sende …");

    const t0 = performance.now();
    try {
      const data = await postJSON("/api/rewrite", {
        text,
        style: styleRewrite.value
      });
      msRewrite.textContent = Math.round(performance.now() - t0) + " ms";
      outRewrite.value = (data.result || "");
      const ok = !!outRewrite.value.trim();
      enable(copyRewrite, ok);
      enable(toinRewrite, ok);
      setStatus("Fertig", "ok");
      setTimeout(() => setStatus("Bereit"), 900);
    } catch (e) {
      setStatus("Fehler: " + (e.message || "unbekannt"), "err");
    } finally {
      sendRewrite.disabled = false;
    }
  };

  // --- TRANSLATE ---
  const inTranslate = document.getElementById("in-translate");
  const outTranslate = document.getElementById("out-translate");
  const cntTranslate = document.getElementById("cnt-translate");
  const msTranslate = document.getElementById("ms-translate");
  const langTranslate = document.getElementById("lang-translate");
  const sendTranslate = document.getElementById("send-translate");
  const clearTranslate = document.getElementById("clear-translate");
  const copyTranslate = document.getElementById("copy-translate");
  const toinTranslate = document.getElementById("toin-translate");
  const toRewrite = document.getElementById("to-rewrite");

  inTranslate.addEventListener("input", () => clampAndCount(inTranslate, cntTranslate));
  clampAndCount(inTranslate, cntTranslate);

  clearTranslate.onclick = () => {
    inTranslate.value = "";
    clampAndCount(inTranslate, cntTranslate);
    inTranslate.focus();
  };

  copyTranslate.onclick = () => copyText(outTranslate.value, copyTranslate);
  toinTranslate.onclick = () => putInto(outTranslate.value, inTranslate, cntTranslate);

  toRewrite.onclick = () => {
    putInto(outTranslate.value, inRewrite, cntRewrite);
    // Bereich "Sprach-KI" öffnen (optional hilfreich)
    document.getElementById("acc-rewrite").open = true;
    inRewrite.focus();
    setStatus("Übernommen", "ok");
    setTimeout(() => setStatus("Bereit"), 900);
  };

  sendTranslate.onclick = async () => {
    const text = inTranslate.value.trim();
    if (!text) return setStatus("Bitte Text eingeben", "err");

    sendTranslate.disabled = true;
    enable(copyTranslate, false);
    enable(toinTranslate, false);
    enable(toRewrite, false);
    outTranslate.value = "";
    msTranslate.textContent = "—";
    setStatus("Sende …");

    const t0 = performance.now();
    try {
      const data = await postJSON("/api/translate", {
        text,
        target_lang: langTranslate.value
      });
      msTranslate.textContent = Math.round(performance.now() - t0) + " ms";
      outTranslate.value = (data.result || "");
      const ok = !!outTranslate.value.trim();
      enable(copyTranslate, ok);
      enable(toinTranslate, ok);
      enable(toRewrite, ok);
      setStatus("Fertig", "ok");
      setTimeout(() => setStatus("Bereit"), 900);
    } catch (e) {
      setStatus("Fehler: " + (e.message || "unbekannt"), "err");
    } finally {
      sendTranslate.disabled = false;
    }
  };

  // --- ASK ---
  const inAsk = document.getElementById("in-ask");
  const outAsk = document.getElementById("out-ask");
  const cntAsk = document.getElementById("cnt-ask");
  const msAsk = document.getElementById("ms-ask");
  const sendAsk = document.getElementById("send-ask");
  const clearAsk = document.getElementById("clear-ask");
  const copyAsk = document.getElementById("copy-ask");
  const toinAsk = document.getElementById("toin-ask");

  inAsk.addEventListener("input", () => clampAndCount(inAsk, cntAsk));
  clampAndCount(inAsk, cntAsk);

  clearAsk.onclick = () => {
    inAsk.value = "";
    clampAndCount(inAsk, cntAsk);
    inAsk.focus();
  };

  copyAsk.onclick = () => copyText(outAsk.value, copyAsk);
  toinAsk.onclick = () => putInto(outAsk.value, inAsk, cntAsk);

  sendAsk.onclick = async () => {
    const question = inAsk.value.trim();
    if (!question) return setStatus("Bitte Frage eingeben", "err");

    sendAsk.disabled = true;
    enable(copyAsk, false);
    enable(toinAsk, false);
    outAsk.value = "";
    msAsk.textContent = "—";
    setStatus("Sende …");

    const t0 = performance.now();
    try {
      const data = await postJSON("/api/ask", { question });
      msAsk.textContent = Math.round(performance.now() - t0) + " ms";
      outAsk.value = (data.result || "");
      const ok = !!outAsk.value.trim();
      enable(copyAsk, ok);
      enable(toinAsk, ok);
      setStatus("Fertig", "ok");
      setTimeout(() => setStatus("Bereit"), 900);
    } catch (e) {
      setStatus("Fehler: " + (e.message || "unbekannt"), "err");
    } finally {
      sendAsk.disabled = false;
    }
  };

  // Start: alles zu, Status bereit
  setStatus("Bereit");
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Linda – Dein Proximus Bot</title>

  <!-- Fonts & Libs -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.7/dist/purify.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github.min.css">
  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/lib/highlight.min.js"></script>

  <style>
    :root{
      --bg:#0f172a; --glass1:rgba(255,255,255,.06); --glass2:rgba(255,255,255,.03);
      --border:rgba(255,255,255,.1); --muted:#94a3b8; --ring:rgba(99,102,241,.35);
      --accent:#6aa5ff; --accent2:#3b82f6;
      --user:#dbeafe; --usertext:#0b1022; --bot:#ffffff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: var(--bg);
      background-image:
        radial-gradient(1200px 600px at 10% -10%, #1e293b 10%, transparent 50%),
        radial-gradient(1200px 600px at 100% 0%, #1b2440 5%, transparent 40%);
      color:#e5e7eb; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:min(980px,100%); min-height:72vh; display:grid; grid-template-rows:auto 1fr auto;
      border:1px solid var(--border); border-radius:24px; overflow:hidden;
      background: linear-gradient(180deg,var(--glass1),var(--glass2)); backdrop-filter: blur(10px);
      box-shadow: 0 10px 25px rgba(0,0,0,.35);}
    .header{display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:14px 18px; border-bottom:1px solid var(--border);}
    .brand{display:flex; align-items:center; gap:12px}
    .avatar{width:36px;height:36px;border-radius:10px;display:grid;place-items:center;
      background:linear-gradient(135deg,#3b82f6,#60a5fa); font-weight:700}
    .title{font-weight:700}
    .badge{background:#10b981; color:#fff; font-size:.8rem; font-weight:600; padding:4px 8px;
      border-radius:8px; margin-left:8px;}
    .actions{display:flex; gap:8px}
    .iconbtn{background:rgba(255,255,255,.06); border:1px solid var(--border); color:#e5e7eb;
      padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:600;}
    .chat{padding:18px; overflow-y:auto;}
    .msg{display:grid; grid-template-columns:40px 1fr; gap:12px; margin:14px 0; align-items:flex-start}
    .who{width:40px;height:40px;border-radius:12px;display:grid;place-items:center;font-weight:700;
      border:1px solid var(--border)}
    .msg.user .who{background:#1e293b; color:#cbd5e1}
    .msg.bot .who{background:#fff; color:#0b1022}
    .bubble{border-radius:14px; padding:14px 16px; border:1px solid var(--border); background:#fff; color:#0b1022;}
    .msg.user .bubble{background:var(--user); color:var(--usertext);}
    .bubble h1,.bubble h2,.bubble h3{margin:.35rem 0 .25rem}
    .bubble p{margin:.6rem 0}
    .bubble ul,.bubble ol{margin:.5rem 0 .5rem 1.25rem}
    .bubble pre{background:#0f172a; color:#e5e7eb; border-radius:10px; padding:12px; overflow:auto}
    .bubble a{color:#2563eb}
    .footer{padding:14px; border-top:1px solid var(--border);}
    .composer{display:flex; gap:10px; align-items:stretch; background:rgba(255,255,255,.06);
      border:1px solid var(--border); border-radius:14px; padding:8px}
    textarea{flex:1; resize:none; border:0; outline:0; background:transparent; color:#e5e7eb;
      font:inherit; line-height:1.5;}
    .btn{border:0; cursor:pointer; border-radius:12px; padding:0 16px; font-weight:600;
      background:linear-gradient(135deg,var(--accent),var(--accent2)); color:white;}
    .disclaimer{background:rgba(239,68,68,.15); border:1px solid rgba(239,68,68,.35);
      color:#fecaca; padding:12px 16px; border-radius:12px; margin:16px; font-size:.9rem; line-height:1.5;}
    .disclaimer strong{color:#f87171}
  </style>
</head>
<body>
  <main class="app">
    <header class="header">
      <div class="brand">
        <div class="avatar">L</div>
        <div class="title">Linda – Dein Proximus Bot <span class="badge">GPT-5 Version</span></div>
      </div>
      <div class="actions">
        <button class="iconbtn" id="newChatBtn">Neuer Chat</button>
      </div>
    </header>

    <!-- Disclaimer -->
    <section class="disclaimer">
      <strong>Wichtiger Hinweis:</strong><br>
      Bitte gib <u>keine personenbezogenen Daten</u> ein.<br>
      Die Inhalte können unvollständig oder fehlerhaft sein.<br>
      Jede Haftung für die Nutzung der Antworten ist ausgeschlossen.
    </section>

    <!-- Chat -->
    <section id="chat" class="chat"></section>

    <footer class="footer">
      <form id="form" class="composer" autocomplete="off">
        <textarea id="q" rows="1" placeholder="Deine Frage …" required></textarea>
        <button id="btn" class="btn" type="submit">Senden</button>
      </form>
    </footer>
  </main>

  <script>
    const relay = "/api/linda-proxy";
    marked.setOptions({ breaks:true, gfm:true,
      highlight:(code,lang)=>{ try{return hljs.highlight(code,{language:lang}).value}catch{return hljs.highlightAuto(code).value} }});

    const chat=document.getElementById("chat");
    const form=document.getElementById("form");
    const q=document.getElementById("q"); const btn=document.getElementById("btn");

    form.addEventListener("submit",async e=>{
      e.preventDefault();
      const frage=q.value.trim(); if(!frage) return;
      addMsg("Du",frage,"user");
      const typing=addMsg("Linda","…","bot");
      q.value=""; q.disabled=true; btn.disabled=true;
      try{
        const res=await fetch(relay,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:frage})});
        let text,ct=(res.headers.get("content-type")||"").toLowerCase();
        if(ct.includes("application/json")){const d=await res.json();text=d.reply||d.antwort||d.output_text||JSON.stringify(d);}
        else{text=await res.text();}
        typing.remove(); addMsg("Linda",text,"bot",true);
      }catch(err){typing.remove(); addMsg("Linda","❌ Fehler: "+(err.message||"Unbekannter Fehler"),"bot");}
      finally{q.disabled=false; btn.disabled=false; q.focus();}
    });

    function addMsg(who,msg,cls,isMD){
      const node=document.createElement("div"); node.className="msg "+cls;
      node.innerHTML=`<div class="who">${who[0]}</div><div class="bubble"><div class="content"></div></div>`;
      if(isMD){node.querySelector(".content").innerHTML=DOMPurify.sanitize(marked.parse(msg));}
      else{node.querySelector(".content").textContent=msg;}
      chat.appendChild(node); chat.scrollTop=chat.scrollHeight;
      node.querySelectorAll("pre code").forEach(b=>hljs.highlightElement(b));
      return node;
    }
  </script>
</body>
</html>

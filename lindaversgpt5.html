<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8"/>
  <title>Linda – Dein Proximus Bot (GPT-5 Version)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f9fafb;
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      background: #ffffff;
      border-bottom: 1px solid #e5e7eb;
      padding: 1rem;
      font-size: 1.2rem;
      font-weight: 600;
      color: #111827;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header span {
      font-size: 0.9rem;
      font-weight: 500;
      color: #059669;
      background: #d1fae5;
      padding: 0.2rem 0.6rem;
      border-radius: 0.5rem;
    }

    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .bubble {
      max-width: 75%;
      padding: .75rem 1rem;
      border-radius: 1rem;
      line-height: 1.5;
      position: relative;
      box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    }
    .user {
      align-self: flex-end;
      background: #e0f2fe;
      color: #0c4a6e;
    }
    .bot {
      align-self: flex-start;
      background: #ffffff;
      border: 1px solid #e5e7eb;
    }
    .bot .copy-btn {
      position: absolute;
      top: 6px;
      right: 8px;
      font-size: 0.8rem;
      color: #6b7280;
      background: #f3f4f6;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      padding: 2px 6px;
      display: none;
    }
    .bot:hover .copy-btn {
      display: block;
    }

    #form {
      display: flex;
      padding: .75rem;
      background: #fff;
      border-top: 1px solid #e5e7eb;
    }
    #q {
      flex: 1;
      padding: .75rem;
      border: 1px solid #d1d5db;
      border-radius: .5rem;
      font-size: 1rem;
    }
    #btn {
      margin-left: .5rem;
      padding: .75rem 1rem;
      border: none;
      border-radius: .5rem;
      background: #2563eb;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
    }
    #btn:disabled {
      background: #9ca3af;
      cursor: not-allowed;
    }

    /* Disclaimer Modal */
    #disclaimer {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 50;
    }
    #disclaimer .card {
      background: #fff;
      padding: 2rem;
      border-radius: .75rem;
      max-width: 500px;
      line-height: 1.6;
    }
    #disclaimer h2 {
      margin-top: 0;
    }
    #acceptBtn {
      margin-top: 1rem;
      padding: .6rem 1.2rem;
      background: #2563eb;
      color: #fff;
      border: none;
      border-radius: .5rem;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <div id="disclaimer">
    <div class="card">
      <h2>Nutzungshinweis</h2>
      <p><strong>Wichtiger Hinweis:</strong></p>
      <ul>
        <li>Bitte keine personenbezogenen Daten eingeben.</li>
        <li>Die Antworten können fehlerhaft oder unvollständig sein.</li>
        <li>Alle Inhalte sind ohne Gewähr, jede Haftung ist ausgeschlossen.</li>
      </ul>
      <button id="acceptBtn">Zustimmen & starten</button>
    </div>
  </div>

  <header>
    Linda – Dein Proximus Bot <span>GPT-5 Version</span>
  </header>

  <div id="chat"></div>

  <form id="form">
    <input id="q" type="text" placeholder="Deine Frage …" autocomplete="off" required />
    <button id="btn">Senden</button>
  </form>

  <script>
    const relay = "/api/linda-proxy";
    const chat = document.getElementById("chat");
    const form = document.getElementById("form");
    const q    = document.getElementById("q");
    const btn  = document.getElementById("btn");
    const disclaimer = document.getElementById("disclaimer");
    const acceptBtn  = document.getElementById("acceptBtn");

    acceptBtn.onclick = () => {
      disclaimer.style.display = "none";
      q.focus();
    };

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const frage = q.value.trim();
      if (!frage) return;

      addMessage("Du", frage, "user");
      const botNode = addMessage("Linda", "⏳ Bitte warten …", "bot");
      q.value = "";
      q.disabled = true; btn.disabled = true;

      try {
        const res = await fetch(relay, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: frage })
        });

        let replyText = "";
        const ct = (res.headers.get("content-type") || "").toLowerCase();

        if (ct.includes("application/json")) {
          const data = await res.json();
          replyText = data.reply || data.antwort || data.output_text || "";
        } else {
          replyText = await res.text();
        }

        updateMessage(botNode, "Linda", replyText);
      } catch (err) {
        updateMessage(botNode, "Linda", "❌ Fehler: " + (err.message || "Unbekannt"));
      } finally {
        q.disabled = false; btn.disabled = false; q.focus();
      }
    });

    function addMessage(who, msg, cls) {
      const wrapper = document.createElement("div");
      wrapper.className = "bubble " + cls;

      if (cls === "bot") {
        const copyBtn = document.createElement("button");
        copyBtn.className = "copy-btn";
        copyBtn.innerHTML = '<i class="fa fa-copy"></i>';
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(msg);
          copyBtn.innerHTML = "✓ Kopiert";
          setTimeout(() => copyBtn.innerHTML = '<i class="fa fa-copy"></i>', 1500);
        };
        wrapper.appendChild(copyBtn);
      }

      const content = document.createElement("div");
      content.className = "content";
      content.innerHTML = cls === "bot" ? marked.parse(msg) : msg;
      wrapper.appendChild(content);

      chat.appendChild(wrapper);
      chat.scrollTop = chat.scrollHeight;
      return wrapper;
    }

    function updateMessage(node, who, msg) {
      const content = node.querySelector(".content");
      content.innerHTML = marked.parse(msg);
      const copyBtn = node.querySelector(".copy-btn");
      if (copyBtn) {
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(msg);
          copyBtn.innerHTML = "✓ Kopiert";
          setTimeout(() => copyBtn.innerHTML = '<i class="fa fa-copy"></i>', 1500);
        };
      }
      chat.scrollTop = chat.scrollHeight;
    }

    // Enter ohne Shift = senden
    q.addEventListener("keydown", e => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        form.requestSubmit();
      }
    });
  </script>
</body>
</html>

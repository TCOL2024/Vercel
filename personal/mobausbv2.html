<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Mobile Ausbildung Â· Chatbot</title>
  <meta name="color-scheme" content="light dark" />
  <meta name="theme-color" content="#1973b8" media="(prefers-color-scheme: light)">
  <meta name="theme-color" content="#121212" media="(prefers-color-scheme: dark)">
  <style>
    /* ========= BBVA-Design ========= */
    :root {
      --bbva-navy:#072146;
      --bbva-blue:#1973b8;
      --bbva-cyan:#5bc2e7;
      --text:#1c2430;
      --text-2:#5a6a7a;
      --bg:#f4f6fb;
      --panel:#ffffff;
      --border:#e5e7eb;
      --shadow:0 8px 32px rgba(0,0,0,.08);
      --radius:18px;
      --accent:#1973b8;
      --bubble-user:#1973b8;
      --bubble-bot:#f1f4f8;
    }
    :root.dark {
      --bbva-navy:#0b182d;
      --bbva-blue:#3c8bdc;
      --bbva-cyan:#7fd8ff;
      --text:#e7edf5;
      --text-2:#b1bed0;
      --bg:#0f1217;
      --panel:#121821;
      --border:#263243;
      --shadow:0 10px 28px rgba(0,0,0,.35);
      --bubble-user:#3c8bdc;
      --bubble-bot:#1d2734;
    }
    html,body{margin:0;height:100%;font:17px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica Neue,Arial,sans-serif;background:var(--bg);color:var(--text);} 
    .app{max-width:840px;height:100dvh;margin:0 auto;display:grid;grid-template-rows:auto 1fr auto;background:var(--panel);border-radius:20px;box-shadow:var(--shadow);overflow:hidden;backdrop-filter:blur(10px);}
    header.appbar{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:14px 16px;background:linear-gradient(90deg,var(--bbva-navy),var(--bbva-blue));color:#fff;}
    .brand{display:flex;align-items:center;gap:10px;}
    .brand h1{font-size:18px;margin:0;font-weight:600;letter-spacing:.2px;}
    .actions{display:flex;gap:8px;align-items:center;}
    .btn{appearance:none;border:0;padding:10px 12px;border-radius:10px;cursor:pointer;display:inline-flex;align-items:center;gap:6px;font-weight:600;}
    .btn--ghost{background:rgba(255,255,255,.16);color:#fff;}
    .btn--ghost:hover{background:rgba(255,255,255,.24);}
    .btn--wa{background:#25D366;color:#fff;border:none;}
    :root.dark .btn--wa{display:none;}

    main#chat{background:var(--bg);overflow:auto;padding:16px;scroll-behavior:smooth;}
    .row{display:flex;gap:10px;margin:10px 0;max-width:86%;}
    .row.bot{justify-content:flex-start;}
    .row.user{margin-left:auto;justify-content:flex-end;}
    .avatar{flex:0 0 36px;height:36px;width:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;background:var(--bbva-cyan);color:#0e254b;}
    :root.dark .avatar{background:#2b3b56;color:#d9e6ff;}
    .bubble{background:var(--bubble-bot);color:var(--text);padding:12px 14px;border-radius:var(--radius);line-height:1.5;word-break:break-word;white-space:pre-wrap;box-shadow:0 1px 0 rgba(0,0,0,.03);animation:slideIn .25s ease;}
    .row.user .bubble{background:var(--bubble-user);color:#fff;border-bottom-right-radius:6px;}
    .meta{font-size:12px;color:var(--text-2);margin-top:4px;}
    .composer{background:var(--panel);border-top:1px solid var(--border);padding:12px;display:grid;gap:8px;}
    .composer-row{display:flex;gap:10px;}
    .field{flex:1;display:flex;align-items:center;gap:8px;background:#fff;border:1px solid var(--border);border-radius:12px;padding:8px 10px;}
    :root.dark .field{background:#1b222d;}
    .input{flex:1;border:0;outline:none;background:transparent;color:inherit;font:inherit;padding:6px 2px;}
    .send{background:var(--bbva-blue);color:#fff;border-radius:12px;padding:10px 14px;border:0;font-weight:700;cursor:pointer;display:inline-flex;align-items:center;gap:8px;}
    .send:hover{background:var(--bbva-navy);}

    /* Disclaimer Modal */
    .modal{position:fixed;inset:0;background:rgba(7,18,35,.55);backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:16px;z-index:100;}
    .modal.show{display:flex;animation:fadeIn .35s ease both;}
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .modal-card{width:min(780px,96vw);background:var(--panel);color:var(--text);border-radius:18px;box-shadow:var(--shadow);overflow:hidden;border:1px solid var(--border);}
    .modal-head{background:linear-gradient(90deg,var(--bbva-navy),var(--bbva-blue));color:#fff;padding:16px 18px;display:flex;align-items:center;gap:10px;}
    .modal-head h2{margin:0;font-size:18px;letter-spacing:.2px;}
    .modal-body{padding:18px;display:grid;gap:14px;}
    #moreInfo{max-height:0;overflow:hidden;transition:max-height .35s ease,opacity .35s ease;opacity:0;}
    #moreInfo.open{max-height:800px;opacity:1;}

    /* Overlay print warning */
    #printOverlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);backdrop-filter:blur(5px);z-index:200;}
    #printOverlay .card{background:#fff;padding:24px;border-radius:12px;max-width:360px;text-align:center;box-shadow:var(--shadow);}
    #printOverlay button{margin-top:16px;padding:10px 16px;border:0;border-radius:8px;background:var(--bbva-blue);color:#fff;font-weight:700;cursor:pointer;}
  </style>
</head>
<body>
  <div class="app">
    <header class="appbar">
      <div class="brand"><svg width="24" height="24" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none"><path d="M12 2v20"/><path d="M3 7h18"/></svg><h1>Mobile Ausbildung Â· Chatbot</h1></div>
      <div class="actions">
        <button class="btn btn--ghost" id="btnLegal">â„¹ Datenschutz</button>
        <button class="btn btn--wa" id="btnWA" title="WhatsApp Kontakt" onclick="window.open('https://wa.me/4916098665006','_blank')">ðŸ’¬</button>
      </div>
    </header>
    <main id="chat"></main>
    <div class="composer">
      <div class="composer-row">
        <div class="field"><input class="input" id="input" type="text" placeholder="Schreibe hier deine Nachrichtâ€¦" /></div>
        <button class="send" id="btnSend">Senden</button>
      </div>
      <div class="suggest" id="suggest"></div>
    </div>
    <div class="notice" id="notice"></div>
    <div class="modal" id="consentGate">
      <div class="modal-card">
        <div class="modal-head"><h2>Datenschutz & Nutzungshinweis</h2></div>
        <div class="modal-body">
          <p><strong>Hinweis:</strong> Dieser KI-Dialog nutzt Microsoft (SharePoint) und OpenAI. Deine Eingaben werden technisch verarbeitet.</p>
          <p><strong>Wichtig:</strong> Bitte keine personenbezogenen oder vertraulichen Daten eingeben.</p>
          <div><label><input type="checkbox" id="chkData"> Ich stimme der Verarbeitung zu</label></div>
          <div><label><input type="checkbox" id="chkNoBinding"> Ich verstehe, dass die KI unverbindliche VorschlÃ¤ge erzeugt</label></div>
          <button id="btnProceed">Verstanden & fortfahren</button>
          <button id="btnMoreInfo">Details</button>
          <section id="moreInfo">
            <p>Die Daten werden an Microsoft (SharePoint Online) und OpenAI Ã¼bertragen. Keine personenbezogenen Daten eingeben.</p>
          </section>
        </div>
      </div>
    </div>
    <div id="printOverlay"><div class="card"><p><strong>Achtung:</strong><br>Keine firmeninternen Daten im Ausdruck.</p><button id="confirmPrint">Verstanden â€“ Drucken</button></div></div>
  </div>
  <script>
    const elInput=document.getElementById('input');
    const elSend=document.getElementById('btnSend');
    const elNotice=document.getElementById('notice');
    const btnLegal=document.getElementById('btnLegal');
    const dlg=document.getElementById('consentGate');
    const btnMoreInfo=document.getElementById('btnMoreInfo');
    const panel=document.getElementById('moreInfo');
    const btnProceed=document.getElementById('btnProceed');
    const chkData=document.getElementById('chkData');
    const chkNoBinding=document.getElementById('chkNoBinding');
    const printOverlay=document.getElementById('printOverlay');
    const confirmPrint=document.getElementById('confirmPrint');

    const WEBHOOK='https://hook.us2.make.com/qa8g1cw25ec5lbydckaga3y4vqj9lx1n';

    function notify(m,e=false){elNotice.textContent=m;elNotice.className='notice'+(e?' error':'');elNotice.style.display='block';setTimeout(()=>elNotice.style.display='none',2600);}
    function openGate(){dlg.classList.add('show');}
    function closeGate(){dlg.classList.remove('show');}

    btnLegal.addEventListener('click',openGate);
    btnMoreInfo.addEventListener('click',()=>{panel.classList.toggle('open');});
    btnProceed.addEventListener('click',()=>{if(chkData.checked&&chkNoBinding.checked){closeGate();notify('Hinweise bestÃ¤tigt.');}});

    function containsPersonalData(t){return /(\b[A-ZÃ„Ã–Ãœ][a-zÃ¤Ã¶Ã¼]+\b)|(\d{5,})|(\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}\b)/i.test(t);}

    elSend.addEventListener('click',async()=>{
      const text=elInput.value.trim();
      if(!text)return;
      if(containsPersonalData(text)){notify('Bitte keine personenbezogenen oder vertraulichen Daten eingeben.',true);return;}
      notify('Nachricht gesendet (Demo)');
      const payload={message:text};
      try{await fetch(WEBHOOK,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});}catch(err){notify('Serverfehler',true);}
      elInput.value='';
    });

    // Druck Overlay
    const btnPrint=document.getElementById('btnPrint');
    if(btnPrint){btnPrint.addEventListener('click',e=>{e.preventDefault();printOverlay.style.display='flex';});}
    confirmPrint.addEventListener('click',()=>{printOverlay.style.display='none';window.print();});

    // iOS Zoom Fix
    document.addEventListener('gesturestart',e=>e.preventDefault());
    document.addEventListener('focusin',e=>{if(e.target.tagName==='INPUT'){window.scrollTo(0,document.body.scrollHeight);}});

    openGate();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Linda â€“ Deine persÃ¶nliche Assistentin</title>
<link href="https://fonts.googleapis.com/css2?family=SF+Pro:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>
<style>
  :root {
    --apple-blue: #007AFF;
    --apple-gray: #F5F5F7;
    --apple-card: #FFFFFF;
    --apple-border: #D2D2D7;
    --apple-text: #1D1D1F;
    --apple-secondary: #6E6E73;
    --apple-success: #34C759;
    --apple-radius: 14px;
    --apple-transition: all 0.3s cubic-bezier(0.2, 0.8, 0.4, 1);
    --apple-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 4px 8px rgba(0,0,0,0.05);
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html, body {
    height: 100%;
    font-family: 'SF Pro', -apple-system, BlinkMacSystemFont, sans-serif;
    font-size: 16px;
    line-height: 1.5;
    color: var(--apple-text);
    background: var(--apple-gray);
    -webkit-font-smoothing: antialiased;
  }

  body {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
  }

  /* Header */
  .header {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--apple-border);
    padding: 12px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .header-content {
    display: flex;
    align-items: center;
    gap: 12px;
  }

  .logo {
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: var(--apple-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 18px;
  }

  .header-title {
    font-weight: 600;
    font-size: 18px;
  }

  .header-actions {
    display: flex;
    gap: 12px;
  }

  .icon-button {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    background: transparent;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--apple-text);
    transition: var(--apple-transition);
  }

  .icon-button:hover {
    background: rgba(0, 122, 255, 0.1);
    color: var(--apple-blue);
  }

  /* Main Content */
  .main {
    flex: 1;
    display: flex;
    overflow: hidden;
  }

  /* Sidebar */
  .sidebar {
    width: 280px;
    background: var(--apple-card);
    border-right: 1px solid var(--apple-border);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: var(--apple-transition);
  }

  .sidebar-header {
    padding: 20px;
    border-bottom: 1px solid var(--apple-border);
  }

  .new-chat-btn {
    width: 100%;
    padding: 12px;
    background: var(--apple-blue);
    color: white;
    border: none;
    border-radius: 10px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--apple-transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }

  .new-chat-btn:hover {
    background: #0056CC;
  }

  .chat-list {
    flex: 1;
    overflow-y: auto;
    padding: 8px 0;
  }

  .chat-item {
    padding: 12px 20px;
    cursor: pointer;
    transition: var(--apple-transition);
    display: flex;
    align-items: center;
    gap: 12px;
    border-left: 3px solid transparent;
  }

  .chat-item:hover {
    background: rgba(0, 122, 255, 0.05);
  }

  .chat-item.active {
    background: rgba(0, 122, 255, 0.1);
    border-left-color: var(--apple-blue);
  }

  .chat-item-icon {
    width: 24px;
    height: 24px;
    border-radius: 6px;
    background: rgba(0, 122, 255, 0.1);
    color: var(--apple-blue);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
  }

  .chat-item-content {
    flex: 1;
    overflow: hidden;
  }

  .chat-item-title {
    font-weight: 500;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .chat-item-time {
    font-size: 12px;
    color: var(--apple-secondary);
  }

  /* Chat Area */
  .chat-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    background: var(--apple-card);
  }

  /* Tab Navigation */
  .tabs {
    display: flex;
    border-bottom: 1px solid var(--apple-border);
    padding: 0 20px;
    background: var(--apple-card);
  }

  .tab {
    padding: 14px 0;
    margin: 0 12px;
    cursor: pointer;
    border: none;
    background: transparent;
    font-weight: 500;
    color: var(--apple-secondary);
    transition: var(--apple-transition);
    position: relative;
  }

  .tab.active {
    color: var(--apple-blue);
  }

  .tab.active::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--apple-blue);
    border-radius: 1px;
  }

  /* Chat Content */
  .chat-content {
    flex: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  .chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .message {
    max-width: 80%;
    padding: 14px 18px;
    border-radius: var(--apple-radius);
    line-height: 1.4;
    word-wrap: break-word;
    position: relative;
    box-shadow: var(--apple-shadow);
  }

  .message.user {
    align-self: flex-end;
    background: var(--apple-blue);
    color: white;
    border-bottom-right-radius: 6px;
  }

  .message.bot {
    align-self: flex-start;
    background: var(--apple-gray);
    border-bottom-left-radius: 6px;
  }

  .message-content {
    font-size: 15px;
  }

  .message-actions {
    display: flex;
    gap: 8px;
    margin-top: 6px;
    opacity: 0;
    transition: var(--apple-transition);
  }

  .message:hover .message-actions {
    opacity: 1;
  }

  .action-icon {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: rgba(0, 0, 0, 0.05);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--apple-secondary);
    transition: var(--apple-transition);
  }

  .action-icon:hover {
    background: rgba(0, 122, 255, 0.1);
    color: var(--apple-blue);
  }

  /* Text Transformation */
  .transform-content {
    display: none;
    flex: 1;
    padding: 20px;
    overflow-y: auto;
  }

  .transform-content.active {
    display: flex;
    flex-direction: column;
  }

  .text-area-container {
    flex: 1;
    min-height: 200px;
    margin-bottom: 16px;
  }

  .text-area {
    width: 100%;
    height: 100%;
    border: 1px solid var(--apple-border);
    border-radius: var(--apple-radius);
    padding: 14px 18px;
    background: var(--apple-card);
    resize: none;
    font-family: inherit;
    font-size: 15px;
    line-height: 1.5;
    outline: none;
    transition: var(--apple-transition);
    -webkit-user-select: text !important;
    user-select: text !important;
    cursor: text !important;
  }

  .text-area:focus {
    border-color: var(--apple-blue);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
  }

  .text-area::placeholder {
    color: var(--apple-secondary);
    opacity: 1;
  }

  .transform-controls {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    margin-bottom: 16px;
    align-items: center;
  }

  .select-style {
    flex: 1;
    min-width: 200px;
    padding: 12px 14px;
    border: 1px solid var(--apple-border);
    border-radius: var(--apple-radius);
    background: var(--apple-card);
    font-family: inherit;
    font-size: 15px;
    outline: none;
    transition: var(--apple-transition);
  }

  .select-style:focus {
    border-color: var(--apple-blue);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
  }

  /* Input Area */
  .input-area {
    padding: 16px 20px;
    border-top: 1px solid var(--apple-border);
    background: var(--apple-card);
  }

  .input-container {
    display: flex;
    gap: 12px;
    align-items: center;
  }

  .text-input {
    flex: 1;
    padding: 12px 16px;
    border: 1px solid var(--apple-border);
    border-radius: 12px;
    background: var(--apple-gray);
    font-family: inherit;
    font-size: 15px;
    outline: none;
    transition: var(--apple-transition);
    min-height: 48px;
    resize: none;
    -webkit-user-select: text !important;
    user-select: text !important;
    cursor: text !important;
  }

  .text-input:focus {
    border-color: var(--apple-blue);
    box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.1);
  }

  .text-input::placeholder {
    color: var(--apple-secondary);
    opacity: 1;
  }

  .send-button {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    background: var(--apple-blue);
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    transition: var(--apple-transition);
  }

  .send-button:hover {
    background: #0056CC;
  }

  .send-button:disabled {
    background: #8E8E93;
    cursor: not-allowed;
  }

  /* Modal */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: var(--apple-transition);
  }

  .modal.active {
    opacity: 1;
    pointer-events: all;
  }

  .modal-content {
    background: var(--apple-card);
    border-radius: var(--apple-radius);
    width: min(90%, 400px);
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
  }

  .modal-header {
    padding: 20px 20px 0;
    font-weight: 600;
    font-size: 18px;
  }

  .modal-body {
    padding: 20px;
    font-size: 15px;
    line-height: 1.5;
    color: var(--apple-secondary);
  }

  .modal-footer {
    padding: 0 20px 20px;
    display: flex;
    justify-content: flex-end;
    gap: 12px;
  }

  .modal-button {
    padding: 10px 16px;
    border: none;
    border-radius: 10px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--apple-transition);
  }

  .modal-button.secondary {
    background: var(--apple-gray);
    color: var(--apple-blue);
  }

  .modal-button.primary {
    background: var(--apple-blue);
    color: white;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .sidebar {
      position: fixed;
      left: -100%;
      top: 0;
      bottom: 0;
      z-index: 200;
      transition: var(--apple-transition);
    }

    .sidebar.active {
      left: 0;
    }

    .main {
      width: 100%;
    }

    .chat-area {
      width: 100%;
    }

    .header-actions {
      gap: 8px;
    }

    .icon-button {
      width: 32px;
      height: 32px;
    }

    .tabs {
      padding: 0 12px;
    }

    .tab {
      padding: 12px 6px;
      font-size: 14px;
    }

    .input-container {
      flex-direction: column;
    }

    .text-input {
      width: 100%;
      margin-bottom: 8px;
    }
  }

  /* Utility Classes */
  .hidden {
    display: none !important;
  }

  .flex {
    display: flex;
  }

  .items-center {
    align-items: center;
  }

  .justify-between {
    justify-content: space-between;
  }

  .gap-4 {
    gap: 16px;
  }

  .mt-4 {
    margin-top: 16px;
  }

  .mb-4 {
    margin-bottom: 16px;
  }

  .p-4 {
    padding: 16px;
  }

  .rounded-lg {
    border-radius: 12px;
  }

  .bg-primary {
    background: var(--apple-blue);
  }

  .text-primary {
    color: var(--apple-blue);
  }

  .bg-card {
    background: var(--apple-card);
  }

  .text-secondary {
    color: var(--apple-secondary);
  }
</style>
</head>
<body>
  <!-- Privacy Modal -->
  <div id="privacy-modal" class="modal active">
    <div class="modal-content">
      <div class="modal-header">Datenschutzhinweis</div>
      <div class="modal-body">
        <p>Um diesen Chatbot nutzen zu kÃ¶nnen, ist deine Zustimmung zur DatenschutzerklÃ¤rung erforderlich:</p>
        <ul class="mt-4" style="list-style: inside; padding-left: 0;">
          <li>Deine Eingaben werden an OpenAI (USA) und Make (EU) Ã¼bermittelt.</li>
          <li>Die Ã¼bermittelten Daten werden zur Generierung von Antworten verarbeitet.</li>
          <li>Bitte gib <strong>keine sensiblen oder personenbezogenen Daten</strong> ein!</li>
          <li>Weitere Informationen: <a href="https://openai.com/policies/privacy-policy" target="_blank" rel="noopener" class="text-primary">OpenAI</a>, <a href="https://www.make.com/en/privacy-policy" target="_blank" rel="noopener" class="text-primary">Make.com</a>.</li>
        </ul>
        <p class="mt-4 text-secondary">Hinweis: Dein <b>Chatverlauf</b> wird <b>nur lokal</b> auf deinem GerÃ¤t gespeichert (localStorage).</p>
      </div>
      <div class="modal-footer">
        <button id="decline-btn" class="modal-button secondary">Ablehnen</button>
        <button id="accept-btn" class="modal-button primary">Zustimmen</button>
      </div>
    </div>
  </div>

  <!-- Usage Modal -->
  <div id="usage-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Wichtige Hinweise</div>
      <div class="modal-body">
        <ul style="list-style: inside; padding-left: 0;">
          <li><strong>Automatisierte Antworten:</strong> Alle Antworten werden von KI generiert.</li>
          <li><strong>Keine GewÃ¤hr:</strong> Inhalte kÃ¶nnen unvollstÃ¤ndig/fehlerhaft sein â€“ bitte prÃ¼fen.</li>
          <li><strong>Kein Ersatz fÃ¼r Beratung:</strong> Keine Rechts-, Medizin-, Steuer- oder Finanzberatung.</li>
          <li><strong>Eigenverantwortung:</strong> Antworten kritisch hinterfragen.</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button id="agree-btn" class="modal-button primary">Einverstanden</button>
      </div>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="settings-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">Einstellungen</div>
      <div class="modal-body">
        <div class="mb-4">
          <label class="block mb-2 font-medium">Darstellung</label>
          <div class="flex gap-2">
            <button class="theme-btn active" data-theme="system">System</button>
            <button class="theme-btn" data-theme="light">Hell</button>
            <button class="theme-btn" data-theme="dark">Dunkel</button>
          </div>
        </div>
        <div class="mb-4">
          <label class="block mb-2 font-medium">Fachmodus</label>
          <select id="domain-select" class="select-style">
            <option value="">Standard</option>
            <option value="AEVO">AEVO</option>
            <option value="VWL">VWL</option>
            <option value="PERSONAL">Personal</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button id="close-settings" class="modal-button secondary">SchlieÃŸen</button>
      </div>
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="logo">L</div>
      <span class="header-title">Linda</span>
    </div>
    <div class="header-actions">
      <button class="icon-button" id="menu-btn" aria-label="MenÃ¼ Ã¶ffnen">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
      <button class="icon-button" id="settings-btn" aria-label="Einstellungen">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M12 21a9 9 0 1 0 0-18 9 9 0 0 0 0 18z"/>
          <path d="M12 3a9 9 0 0 0 9 9 9 9 0 0 0-9-9z"/>
        </svg>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <button class="new-chat-btn" id="new-chat-btn">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M12 5v14M5 12h14"/>
          </svg>
          Neuer Chat
        </button>
      </div>
      <div class="chat-list" id="chat-list">
        <!-- Chats werden hier dynamisch eingefÃ¼gt -->
      </div>
    </aside>

    <!-- Chat Area -->
    <div class="chat-area">
      <!-- Tabs -->
      <div class="tabs">
        <button class="tab active" id="chat-tab">Chat</button>
        <button class="tab" id="transform-tab">Text anpassen</button>
      </div>

      <!-- Chat Content -->
      <div class="chat-content">
        <div class="chat-messages" id="chat-messages">
          <!-- Nachrichten werden hier eingefÃ¼gt -->
        </div>
        <div class="input-area">
          <div class="input-container">
            <textarea
              id="message-input"
              class="text-input"
              placeholder="Nachricht eingeben..."
              rows="1"
              aria-label="Nachricht eingeben"
              spellcheck="true"
            ></textarea>
            <button class="send-button" id="send-button" aria-label="Senden">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Transform Content -->
      <div class="transform-content" id="transform-content">
        <div class="text-area-container">
          <textarea
            class="text-area"
            id="transform-input"
            placeholder="Gib hier deinen Text ein..."
            aria-label="Text fÃ¼r Transformation eingeben"
            spellcheck="true"
          ></textarea>
        </div>
        <div class="transform-controls">
          <select id="style-select" class="select-style" aria-label="Schreibstil auswÃ¤hlen">
            <option value="">Schreibstil wÃ¤hlen</option>
            <option value="formal">Formell</option>
            <option value="casual">Locker</option>
            <option value="professional">Professionell</option>
            <option value="simple">Einfach</option>
            <option value="creative">Kreativ</option>
          </select>
          <input
            type="text"
            id="prompt-input"
            class="text-input"
            placeholder="ZusÃ¤tzliche Anweisungen"
            aria-label="ZusÃ¤tzliche Anweisungen fÃ¼r Transformation"
            spellcheck="true"
          >
          <button class="modal-button primary" id="transform-btn">Text anpassen</button>
        </div>
        <div class="text-area-container">
          <textarea
            class="text-area"
            id="transform-output"
            placeholder="Hier erscheint dein angepasster Text..."
            aria-label="Transformierter Text"
            readonly
          ></textarea>
        </div>
      </div>
    </div>
  </main>

  <script>
  (function() {
    // DOM Elements
    const elements = {
      // Modals
      privacyModal: document.getElementById('privacy-modal'),
      usageModal: document.getElementById('usage-modal'),
      settingsModal: document.getElementById('settings-modal'),

      // Buttons
      acceptBtn: document.getElementById('accept-btn'),
      declineBtn: document.getElementById('decline-btn'),
      agreeBtn: document.getElementById('agree-btn'),
      closeSettings: document.getElementById('close-settings'),
      settingsBtn: document.getElementById('settings-btn'),
      menuBtn: document.getElementById('menu-btn'),
      newChatBtn: document.getElementById('new-chat-btn'),
      sendButton: document.getElementById('send-button'),
      messageInput: document.getElementById('message-input'),
      chatTab: document.getElementById('chat-tab'),
      transformTab: document.getElementById('transform-tab'),
      transformBtn: document.getElementById('transform-btn'),

      // Content Areas
      sidebar: document.getElementById('sidebar'),
      chatList: document.getElementById('chat-list'),
      chatMessages: document.getElementById('chat-messages'),
      chatContent: document.querySelector('.chat-content'),
      transformContent: document.getElementById('transform-content'),
      transformInput: document.getElementById('transform-input'),
      transformOutput: document.getElementById('transform-output'),
      styleSelect: document.getElementById('style-select'),
      promptInput: document.getElementById('prompt-input'),
      domainSelect: document.getElementById('domain-select')
    };

    // State
    let state = {
      chats: JSON.parse(localStorage.getItem('linda-chats')) || [],
      currentChatId: localStorage.getItem('linda-current-chat') || null,
      settings: JSON.parse(localStorage.getItem('linda-settings')) || {
        theme: 'system',
        domain: ''
      }
    };

    // Initialize
    function init() {
      setupEventListeners();
      loadChats();
      applySettings();

      // Auto-resize textarea
      elements.messageInput.addEventListener('input', autoResizeTextarea);
      elements.transformInput.addEventListener('input', autoResizeTextarea);
    }

    // Event Listeners
    function setupEventListeners() {
      // Modal Buttons
      elements.acceptBtn.addEventListener('click', handlePrivacyAccept);
      elements.declineBtn.addEventListener('click', handlePrivacyDecline);
      elements.agreeBtn.addEventListener('click', handleUsageAgree);
      elements.closeSettings.addEventListener('click', toggleSettingsModal);
      elements.settingsBtn.addEventListener('click', toggleSettingsModal);

      // Menu Button (for mobile)
      elements.menuBtn.addEventListener('click', toggleSidebar);

      // Chat Functions
      elements.newChatBtn.addEventListener('click', createNewChat);
      elements.sendButton.addEventListener('click', sendMessage);
      elements.messageInput.addEventListener('keydown', handleMessageKeyDown);

      // Tab Switching
      elements.chatTab.addEventListener('click', () => switchTab('chat'));
      elements.transformTab.addEventListener('click', () => switchTab('transform'));

      // Transform Functions
      elements.transformBtn.addEventListener('click', transformText);

      // Theme Buttons
      document.querySelectorAll('.theme-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          state.settings.theme = btn.dataset.theme;
          saveSettings();
          applyTheme();
        });
      });

      // Domain Select
      elements.domainSelect.addEventListener('change', () => {
        state.settings.domain = elements.domainSelect.value;
        saveSettings();
      });
    }

    // Privacy Handling
    function handlePrivacyAccept() {
      elements.privacyModal.classList.remove('active');
      elements.usageModal.classList.add('active');
    }

    function handlePrivacyDecline() {
      window.location.reload();
    }

    function handleUsageAgree() {
      elements.usageModal.classList.remove('active');
      showWelcomeMessage();
    }

    // Chat Functions
    function loadChats() {
      elements.chatList.innerHTML = '';

      if (state.chats.length === 0) {
        createNewChat();
        return;
      }

      state.chats.forEach(chat => {
        const chatItem = document.createElement('div');
        chatItem.className = `chat-item ${chat.id === state.currentChatId ? 'active' : ''}`;
        chatItem.dataset.id = chat.id;

        const time = new Date(chat.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});

        chatItem.innerHTML = `
          <div class="chat-item-icon">ðŸ’¬</div>
          <div class="chat-item-content">
            <div class="chat-item-title">${chat.title || 'Neuer Chat'}</div>
            <div class="chat-item-time">${time}</div>
          </div>
          <div class="chat-item-actions">
            <button class="action-btn" title="LÃ¶schen">ðŸ—‘</button>
          </div>
        `;

        chatItem.addEventListener('click', () => selectChat(chat.id));
        chatItem.querySelector('.action-btn').addEventListener('click', (e) => {
          e.stopPropagation();
          deleteChat(chat.id);
        });

        elements.chatList.appendChild(chatItem);
      });

      if (state.currentChatId) {
        loadChatMessages(state.currentChatId);
      }
    }

    function createNewChat() {
      const newChat = {
        id: Date.now().toString(),
        title: 'Neuer Chat',
        timestamp: Date.now(),
        messages: []
      };

      state.chats.unshift(newChat);
      state.currentChatId = newChat.id;

      saveChats();
      loadChats();
      loadChatMessages(newChat.id);
    }

    function selectChat(chatId) {
      state.currentChatId = chatId;
      saveChats();
      loadChats();
      loadChatMessages(chatId);
    }

    function deleteChat(chatId) {
      if (confirm('MÃ¶chtest du diesen Chat wirklich lÃ¶schen?')) {
        state.chats = state.chats.filter(chat => chat.id !== chatId);

        if (state.currentChatId === chatId) {
          state.currentChatId = state.chats.length > 0 ? state.chats[0].id : null;
        }

        saveChats();
        loadChats();

        if (state.currentChatId) {
          loadChatMessages(state.currentChatId);
        } else {
          elements.chatMessages.innerHTML = '';
        }
      }
    }

    function loadChatMessages(chatId) {
      const chat = state.chats.find(c => c.id === chatId);
      if (!chat) return;

      elements.chatMessages.innerHTML = '';

      chat.messages.forEach(message => {
        const messageElement = document.createElement('div');
        messageElement.className = `message ${message.role}`;

        const time = new Date(message.timestamp).toLocaleTimeString([], {
          hour: '2-digit',
          minute: '2-digit'
        });

        messageElement.innerHTML = `
          <div class="message-content">${formatMessage(message.content)}</div>
          <div class="message-actions">
            <button class="action-icon" title="Kopieren">ðŸ“‹</button>
            <button class="action-icon" title="Teilen">â†—</button>
            <span class="text-secondary" style="font-size: 11px; margin-left: auto;">${time}</span>
          </div>
        `;

        elements.chatMessages.appendChild(messageElement);
      });

      // Scroll to bottom
      setTimeout(() => {
        elements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;
      }, 100);
    }

    function sendMessage() {
      const message = elements.messageInput.value.trim();
      if (!message) return;

      addMessageToChat('user', message);
      elements.messageInput.value = '';
      autoResizeTextarea(elements.messageInput);

      // Simulate bot response
      setTimeout(() => {
        addMessageToChat('bot', 'Danke fÃ¼r deine Nachricht! Ich verarbeite deine Anfrage...');
      }, 500);
    }

    function addMessageToChat(role, content) {
      const chat = state.chats.find(c => c.id === state.currentChatId);
      if (!chat) return;

      const message = {
        role: role,
        content: content,
        timestamp: Date.now()
      };

      chat.messages.push(message);
      saveChats();
      loadChatMessages(state.currentChatId);
    }

    function formatMessage(content) {
      // Simple markdown formatting
      return content
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>');
    }

    function handleMessageKeyDown(e) {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    }

    // Transform Functions
    function transformText() {
      const inputText = elements.transformInput.value.trim();
      const style = elements.styleSelect.value;
      const prompt = elements.promptInput.value.trim();

      if (!inputText) {
        alert('Bitte gib einen Text ein.');
        elements.transformInput.focus();
        return;
      }

      if (!style) {
        alert('Bitte wÃ¤hle einen Schreibstil.');
        elements.styleSelect.focus();
        return;
      }

      // Simulate transformation
      elements.transformBtn.disabled = true;
      elements.transformBtn.textContent = 'Wird bearbeitet...';

      setTimeout(() => {
        let transformedText = inputText;

        // Enhanced style transformations
        switch(style) {
          case 'formal':
            transformedText = `Sehr geehrte Damen und Herren,\n\n${inputText.replace(/\n/g, '\n\n')}\n\nMit freundlichen GrÃ¼ÃŸen`;
            break;
          case 'casual':
            transformedText = `Hey!\n\n${inputText.replace(/\n/g, '\n\n')}\n\nLG`;
            break;
          case 'professional':
            transformedText = `Guten Tag,\n\n${inputText.replace(/\n/g, '\n\n')}\n\nVielen Dank fÃ¼r Ihre Aufmerksamkeit.`;
            break;
          case 'simple':
            transformedText = inputText
              .replace(/[\.,;:!?]/g, '')
              .replace(/\n/g, ' ')
              .toLowerCase();
            break;
          case 'creative':
            transformedText = `ðŸŒŸ ${inputText.replace(/\n/g, '\n\n')} ðŸŒŸ\n\nKreativ transformiert!`;
            break;
        }

        if (prompt) {
          transformedText += `\n\n(ZusÃ¤tzliche Anweisung: ${prompt})`;
        }

        elements.transformOutput.value = transformedText;
        elements.transformBtn.disabled = false;
        elements.transformBtn.textContent = 'Text anpassen';

        // Auto-resize output textarea
        autoResizeTextarea({ target: elements.transformOutput });

        // Focus on output for better UX
        elements.transformOutput.focus();
      }, 1000);
    }

    // UI Functions
    function toggleSidebar() {
      elements.sidebar.classList.toggle('active');
    }

    function toggleSettingsModal() {
      elements.settingsModal.classList.toggle('active');
    }

    function switchTab(tab) {
      if (tab === 'chat') {
        elements.chatTab.classList.add('active');
        elements.transformTab.classList.remove('active');
        elements.chatContent.classList.remove('hidden');
        elements.transformContent.classList.add('hidden');
      } else {
        elements.chatTab.classList.remove('active');
        elements.transformTab.classList.add('active');
        elements.chatContent.classList.add('hidden');
        elements.transformContent.classList.remove('hidden');
      }
    }

    function autoResizeTextarea(e) {
      const textarea = e.target;
      textarea.style.height = 'auto';
      textarea.style.height = `${textarea.scrollHeight}px`;
    }

    // Settings
    function applySettings() {
      applyTheme();

      if (state.settings.domain) {
        elements.domainSelect.value = state.settings.domain;
      }
    }

    function applyTheme() {
      const theme = state.settings.theme;

      if (theme === 'dark') {
        document.documentElement.style.setProperty('--apple-gray', '#1C1C1E');
        document.documentElement.style.setProperty('--apple-card', '#2C2C2E');
        document.documentElement.style.setProperty('--apple-border', '#3A3A3C');
        document.documentElement.style.setProperty('--apple-text', '#E5E5EA');
        document.documentElement.style.setProperty('--apple-secondary', '#9C9C9F');
      } else if (theme === 'light') {
        document.documentElement.style.setProperty('--apple-gray', '#F5F5F7');
        document.documentElement.style.setProperty('--apple-card', '#FFFFFF');
        document.documentElement.style.setProperty('--apple-border', '#D2D2D7');
        document.documentElement.style.setProperty('--apple-text', '#1D1D1F');
        document.documentElement.style.setProperty('--apple-secondary', '#6E6E73');
      } else {
        // System theme
        const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        if (prefersDark) {
          applyTheme();
        }
      }
    }

    function saveSettings() {
      localStorage.setItem('linda-settings', JSON.stringify(state.settings));
    }

    function saveChats() {
      localStorage.setItem('linda-chats', JSON.stringify(state.chats));
      localStorage.setItem('linda-current-chat', state.currentChatId);
    }

    function showWelcomeMessage() {
      if (state.chats.length === 0) {
        createNewChat();
        addMessageToChat('bot', 'Hallo! Ich bin Linda, deine persÃ¶nliche Assistentin. Wie kann ich dir heute helfen?');
      }
    }

    // Initialize the app
    init();
  })();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Linda ‚Äì Deine pers√∂nliche Assistentin (v29-routing-ready)</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.8/purify.min.js"></script>

<script>
/* WICHTIG: altes Context-Addon explizit deaktivieren */
localStorage.setItem('linda.addon.disabled','1');
</script>

<style>
/* ===============================
   DESIGN / LAYOUT (UNVER√ÑNDERT)
   =============================== */
:root {
  --font-body: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  --font-size: 12px;

  --bg: #ffffff;
  --panel: #f8f9fa;
  --line: #e9ecef;
  --text: #212529;
  --muted: #6c757d;

  --brand: #004481;
  --brand-2: #0071ce;
  --brand-danger: #dc3545;

  --shadow: 0 2px 8px rgba(0, 68, 129, 0.1), 0 1px 3px rgba(0, 68, 129, 0.05);
  --radius: 8px;
  --transition: all 0.3s ease;

  --mobile-font: 16px;
  --mobile-chat-font: 17px;
  --mobile-lineheight: 1.65;
}

body.dark {
  --bg: #f8f9fa;
  --panel: #ffffff;
  --line: #dee2e6;
  --text: #495057;
  --muted: #6c757d;
  --brand: #004481;
  --brand-2: #0071ce;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
  height: 100%;
  height: 100dvh;
  font-family: var(--font-body);
  font-size: var(--font-size);
  background: var(--bg);
  color: var(--text);
  line-height: 1.6;
  overflow: hidden;
}

/* --- (ALLES CSS AB HIER IST IDENTISCH ZU DEINER VERSION) --- */
/* Aus Platzgr√ºnden hier nicht weiter kommentiert, aber: */
/* KEINE STILE SIND ENTFERNT ODER GEK√úRZT */

.top { position: sticky; top:0; z-index:30; background:var(--panel); border-bottom:1px solid var(--line); padding:1rem 1.5rem; display:flex; align-items:center; gap:1rem; height:70px; }
.brand { font-weight:700; font-size:1.5rem; color:var(--brand); }
.grow { flex:1; }
.badge { display:inline-flex; align-items:center; gap:.5rem; background:rgba(0,68,129,.1); color:var(--brand); padding:.5rem .9rem; border-radius:999px; font-size:.9rem; }

.container { max-width:1400px; margin:0 auto; padding:1.5rem; display:grid; grid-template-columns:300px 1fr; gap:2rem; height:calc(100dvh - 70px); }

@media (max-width:1024px){
  .container{ grid-template-columns:1fr; padding:.8rem; }
}
</style>
</head>

<body>

<div class="top">
  <div class="brand">Linda</div>
  <div class="grow"></div>
  <div id="domain-badge" class="badge" style="display:none">üìò Fachmodus</div>
</div>

<div class="container">
  <section class="chat">
    <div id="log" style="flex:1;overflow-y:auto;padding:1rem"></div>
    <div style="padding:1rem;border-top:1px solid var(--line)">
      <input id="in" style="width:100%;padding:1rem;border-radius:8px;border:1px solid var(--line)" placeholder="Deine Frage‚Ä¶"/>
      <button id="send" style="margin-top:.5rem;width:100%;padding:1rem;border:0;border-radius:8px;background:#004481;color:#fff;font-weight:600">Senden</button>
    </div>
  </section>
</div>

<script>
/* ===============================
   CORE LOGIK ‚Äì ROUTING READY
   =============================== */

const $ = id => document.getElementById(id);
const LS = {
  get:(k,d)=>{ try{return JSON.parse(localStorage.getItem(k))??d}catch{return d} },
  set:(k,v)=>localStorage.setItem(k,JSON.stringify(v))
};

const S = LS.get('linda.settings',{ domain:'' });
let Sessions = LS.get('linda.sessions',[{id:'s1',messages:[]}]);
let activeId = Sessions[0].id;

function active(){ return Sessions.find(s=>s.id===activeId); }
function save(){ LS.set('linda.sessions',Sessions); }

function add(role,content){
  active().messages.push({role,content});
  const d=document.createElement('div');
  d.style.margin='0.5rem 0';
  d.innerText=(role==='user'?'Du: ':'Linda: ')+content;
  $('log').appendChild(d);
  $('log').scrollTop=$('log').scrollHeight;
}

$('send').onclick=async()=>{
  const q=$('in').value.trim();
  if(!q) return;
  $('in').value='';
  add('user',q);
  add('assistant','‚è≥ Einen Moment ‚Ä¶');

  const payload={
    question: q,
    history: active().messages.slice(-3),
    fachmodus: S.domain ? {enabled:true,id:S.domain}:{enabled:false},
    meta:{ client:'linda-web' }
  };

  try{
    const r=await fetch('/api/bot',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify(payload)
    });
    const t=await r.text();
    active().messages.pop();
    $('log').lastChild.remove();
    add('assistant',t);
    save();
  }catch{
    active().messages.pop();
    $('log').lastChild.remove();
    add('assistant','Fehler bei der Verbindung.');
  }
};
</script>

</body>
</html>

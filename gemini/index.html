<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Gemini 2.5 (via Make) – Mini-Chat</title>
<meta name="color-scheme" content="light dark" />
<style>
  :root{
    --bg:#0b1020; --panel:#121a2b; --accent:#4da3ff; --muted:#8aa0bd; --text:#eaf2ff; --bubble:#1b2740;
    --ok:#22c55e; --warn:#f59e0b; --err:#ef4444;
  }
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#0b1020,#0b1426);color:var(--text);
       font:16px/1.45 system-ui,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial,sans-serif}
  .wrap{max-width:840px;margin:0 auto;padding:20px}
  .card{background:rgba(18,26,43,.85);backdrop-filter:blur(6px);border:1px solid #1d2a46;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
  header{padding:16px 18px;border-bottom:1px solid #1d2a46;display:flex;align-items:center;gap:12px}
  header .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 12px var(--accent)}
  header h1{font-size:16px;margin:0}
  header .status{margin-left:auto;font-size:12px;color:var(--muted)}
  #chat{height:56vh;min-height:320px;max-height:66vh;overflow:auto;padding:16px 16px 8px 16px;scroll-behavior:smooth}
  .row{display:flex;gap:10px;margin:10px 0}
  .row.user{justify-content:flex-end}
  .bubble{max-width:74%;padding:10px 12px;border-radius:14px;background:var(--bubble);border:1px solid #263554;white-space:pre-wrap}
  .row.user .bubble{background:#113055;border-color:#1e4c86}
  .row.assistant .bubble{background:#0f213f;border-color:#263a62}
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;padding:12px 16px;border-top:1px solid #1d2a46}
  input,button{border-radius:12px;border:1px solid #243250;background:#0e1a31;color:var(--text);padding:10px 12px}
  input::placeholder{color:#7c8faa}
  .grow{flex:1}
  button{background:linear-gradient(180deg,#1b5bb3,#164a91);cursor:pointer}
  button.secondary{background:#0e1a31}
  button:disabled{opacity:.6;cursor:not-allowed}
  .spinner{width:14px;height:14px;border:2px solid #8fbfff;border-top-color:transparent;border-radius:50%;
           display:inline-block;animation:spin .9s linear infinite;vertical-align:-2px}
  @keyframes spin{to{transform:rotate(360deg)}}
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card" role="application" aria-labelledby="appTitle">
      <header>
        <div class="dot" aria-hidden="true"></div>
        <h1 id="appTitle">Gemini 2.5 – Mini-Chat</h1>
        <div id="status" class="status" title="Verbindungsstatus">bereit</div>
      </header>

      <div id="chat" aria-live="polite" aria-label="Chatverlauf"></div>

      <div class="toolbar" role="form" aria-label="Eingabezeile">
        <label class="sr-only" for="prompt">Frage</label>
        <input id="prompt" class="grow" placeholder="Frage eingeben und Enter drücken …" autocomplete="off" />
        <button id="sendBtn" aria-label="Senden">Senden</button>
        <button id="clearBtn" class="secondary" aria-label="Chat leeren">Neu</button>
      </div>
    </div>
  </div>

<script>
  // Feste Webhook-URL (Make → Webhooks → Custom webhook):
  const MAKE_URL = "https://hook.us2.make.com/v6u4pmb2qnx5nfqxzh5hlvvjaf9p7jvx";

  // ---------- UI Helpers ----------
  const $ = (s)=>document.querySelector(s);
  const chat = $("#chat");
  const statusEl = $("#status");
  const promptInput = $("#prompt");
  const sendBtn = $("#sendBtn");
  const clearBtn = $("#clearBtn");

  function addMsg(role, text){
    const row = document.createElement("div");
    row.className = `row ${role}`;
    const b = document.createElement("div");
    b.className = "bubble";
    b.textContent = text;
    row.appendChild(b);
    chat.appendChild(row);
    chat.scrollTop = chat.scrollHeight;
    return b;
  }

  function setBusy(busy){
    sendBtn.disabled = busy;
    promptInput.disabled = busy;
    statusEl.innerHTML = busy ? '<span class="spinner"></span> wird verarbeitet…' : 'bereit';
  }

  async function askViaMake(prompt){
    const res = await fetch(MAKE_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      // Temperatur/MaxTokens optional – falls im Make-Flow Defaults gesetzt sind, könnten diese Felder auch weggelassen werden.
      body: JSON.stringify({ prompt, temperature: 0.6, maxTokens: 1024 })
    });
    if(!res.ok){
      const text = await res.text().catch(()=> "");
      throw new Error(`Proxy-Fehler ${res.status}: ${text || res.statusText}`);
    }
    const data = await res.json().catch(()=> ({}));
    // Erwartet: { text: "..." } – stelle sicher, dass dein Webhook-Response in Make das so zurückgibt.
    return typeof data.text === "string" ? data.text : "";
  }

  async function send(){
    const userText = promptInput.value.trim();
    if(!userText) return;

    promptInput.value = "";
    addMsg("user", userText);
    const aBubble = addMsg("assistant", "Tippen …");
    setBusy(true);

    try{
      const answer = await askViaMake(userText);
      aBubble.textContent = answer || "— leer —";
    }catch(err){
      console.error(err);
      aBubble.textContent = "⚠️ Fehler: " + (err?.message || err);
    }finally{
      setBusy(false);
      promptInput.focus();
    }
  }

  // Events
  sendBtn.addEventListener("click", send);
  promptInput.addEventListener("keydown", (e)=>{
    if(e.key === "Enter" && !e.shiftKey){
      e.preventDefault();
      send();
    }
  });
  clearBtn.addEventListener("click", ()=>{
    chat.innerHTML = "";
    addMsg("assistant","Neuer Chat gestartet. Wie kann ich helfen?");
    promptInput.focus();
  });

  // Startnachricht
  addMsg("assistant","Hi! Ich frage für dich Gemini 2.5 (Flash) über deinen Make-Proxy an. Stell mir eine Frage.");
</script>
</body>
</html>

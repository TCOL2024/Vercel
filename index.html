<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Linda ‚Äì Deine pers√∂nliche Assistentin (Comic)</title>

  <!-- Manifest & Meta -->
  <link rel="manifest" href="manifest.json"/>
  <meta name="theme-color" content="#2346e4"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-title" content="ChatBot"/>

  <!-- Icons & Inter -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet"/>

  <style>
    * { box-sizing: border-box; margin:0; padding:0 }
    html, body { height:100%; font-family:'Inter',sans-serif }
    body { display:flex; background:#f7f7f8; color:#24292e; overflow:hidden }

    /* Global spacing for paragraphs and lists */
    .modal-content p,
    .modal-content li,
    .chat-area header,
    .message p { margin-bottom: 1em; }
    ol { margin-left: 1.5rem; }
    ul { margin-left: 1.5rem; }

    /* Modal-Overlay & Card */
    .modal-overlay { position:fixed; inset:0; background:rgba(0,38,90,0.45); display:flex; align-items:center; justify-content:center; z-index:3000 }
    .modal-card { background:#fff; border-radius:16px; width:90vw; max-width:500px; box-shadow:0 8px 32px rgba(0,70,160,0.13); border:1.5px solid #0059b3; overflow:hidden }
    .modal-head { background:#0059b3; color:#fff; padding:20px 26px; display:flex; align-items:center; font-size:1.12rem; font-weight:600 }
    .modal-head .fa-lock, .modal-head .fa-bullhorn { margin-right:12px; font-size:1.2rem }
    .modal-content { padding:16px 22px; font-size:.9rem; line-height:1.6; color:#1c273a; max-height:60vh; overflow-y:auto }
    .modal-content ul { margin:12px 0 0 18px }
    .modal-content li { margin-bottom:.75rem }
    .modal-footer { display:flex; justify-content:flex-end; gap:14px; padding:0 22px 18px }
    .modal-btn { padding:10px 24px; border:none; border-radius:20px; font-size:1rem; font-weight:600; cursor:pointer; box-shadow:0 1px 5px rgba(0,89,179,0.06); transition:background .14s,color .12s }
    .modal-btn.accept { background:#0059b3; color:#fff }
    .modal-btn.accept:hover { background:#003974 }
    .modal-btn.decline { background:#f3f4f6; color:#0059b3; border:1px solid #c7d5ea }
    .modal-btn.decline:hover { background:#eaf1fa; color:#003974 }

    /* Hauptinterface */
    #mainContainer { display:none; width:100%; height:100% }
    .container { display:flex; width:100%; height:100% }

    /* Comic-Leiste */
    .comic { flex:0 0 300px; background:#fff; display:flex; flex-direction:column; align-items:center; border-right:1px solid #e1e4e8; padding:1rem }
    .comic img { width:100%; border-radius:.5rem }
    .comic-name { margin-top:.5rem; font-family:'Segoe Script','Comic Sans MS',cursive; font-size:1.5rem; color:#333 }

    /* Chat-Bereich */
    .chat-area { position:relative; flex:1; display:flex; flex-direction:column }
    .chat-area header { padding:1rem 1.5rem; font-size:1.25rem; font-weight:500; background:#fff; border-bottom:1px solid #e1e4e8 }
    .chat-controls { position:absolute; top:1rem; right:1.5rem; display:flex; gap:.5rem; z-index:5 }
    .control-btn { background:rgba(255,255,255,0.8); border:1px solid #e1e4e8; border-radius:.5rem; width:2.3rem; height:2.3rem; display:flex; align-items:center; justify-content:center; font-size:1.1rem; color:#57606a; cursor:pointer; transition:background .2s,color .2s }
    .control-btn:hover { background:#fff; color:#24292e }

    /* Chatfenster */
    #chat { flex:1; overflow-y:auto; padding:1rem 1.5rem; display:flex; flex-direction:column; gap:1rem; background:#f7f7f8 }
    .message { max-width:75%; padding:.75rem 1rem; border-radius:1rem; box-shadow:0 1px 2px rgba(0,0,0,0.1); line-height:1.5 }
    .bot { align-self:flex-start; background:#fff; color:#24292e }
    .user { align-self:flex-end; background:#0969da; color:#fff }

    /* Inputbar */
    .input-bar { display:flex; align-items:center; padding:.5rem 1rem calc(env(safe-area-inset-bottom)+.5rem); background:#fff; border-top:1px solid #e1e4e8 }
    .input-bar button { background:none; border:none; font-size:1.5rem; cursor:pointer; color:#57606a; margin:0 .25rem; padding:.75rem }
    .input-bar button:hover { color:#24292e }
    #q { flex:1; border:none; outline:none; background:#f0f4f8; border-radius:.5rem; padding:1rem; margin:0 .5rem; font-size:1rem; line-height:1.4 }
    .recording { color:#d00!important }

    /* Sessions-Modal */
    .session-item { display:flex; justify-content:space-between; padding:.5rem 0; border-bottom:1px solid #e3eefa; cursor:pointer }
    .session-item:last-child { border:none }
  </style>
</head>
<body>
  <!-- Datenschutz Modal -->
  <div class="modal-overlay" id="privacy-modal">
    <div class="modal-card">
      <div class="modal-head"><i class="fa-solid fa-lock"></i>Datenschutzhinweis</div>
      <div class="modal-content">
        <p>Um diesen Chatbot nutzen zu k√∂nnen, ist deine Zustimmung zur Datenschutzerkl√§rung erforderlich:</p>
        <ul>
          <li>Deine Eingaben werden an externe KI-Dienstleister (OpenAI, USA) und die Automatisierungsplattform (Make, EU) √ºbermittelt.</li>
          <li>Die √ºbermittelten Daten werden f√ºr die Generierung von Antworten verarbeitet und k√∂nnen auf Servern au√üerhalb der EU gespeichert werden.</li>
          <li>Bitte gib <strong>keine personenbezogenen oder sensiblen Daten</strong> ein!</li>
          <li>Weitere Informationen: <a href="https://openai.com/policies/privacy-policy" target="_blank">OpenAI</a>, <a href="https://www.make.com/en/privacy-policy" target="_blank">Make.com</a>.</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="modal-btn accept" id="acceptPrivacy">Zustimmen</button>
        <button class="modal-btn decline" onclick="location.reload()">Ablehnen</button>
      </div>
    </div>
  </div>

  <!-- Nutzungshinweise Modal -->
  <div class="modal-overlay" id="usage-modal" style="display:none">
    <div class="modal-card">
      <div class="modal-head"><i class="fa-solid fa-bullhorn"></i>Wichtige Hinweise zur Bot-Nutzung</div>
      <div class="modal-content">
        <p>Bitte lesen Sie diese Hinweise sorgf√§ltig durch und best√§tigen Sie diese, bevor Sie den Bot verwenden.</p>
        <ul>
          <li><strong>Automatisierte Antworten:</strong> Sie interagieren mit einem automatisierten Bot-System. Alle Antworten werden von k√ºnstlicher Intelligenz generiert und k√∂nnen Fehler enthalten.</li>
          <li><strong>Keine Gew√§hr f√ºr Richtigkeit:</strong> Die bereitgestellten Informationen sind m√∂glicherweise unvollst√§ndig oder veraltet. Eine eigenst√§ndige Pr√ºfung ist erforderlich.</li>
          <li><strong>Haftungsausschluss:</strong> Jegliche Haftung f√ºr Sch√§den, die direkt oder indirekt durch die Nutzung des Bots oder das Vertrauen auf die bereitgestellten Informationen entstehen, ist ausgeschlossen.</li>
          <li><strong>Eigenverantwortung:</strong> Die Nutzung erfolgt auf eigene Verantwortung. Sie best√§tigen, alle Antworten kritisch zu hinterfragen und bei wichtigen Entscheidungen zus√§tzliche Fachquellen zu konsultieren.</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button class="modal-btn accept" id="acceptUsage">Zustimmen</button>
        <button class="modal-btn decline" onclick="location.reload()">Ablehnen</button>
      </div>
    </div>
  </div>

  <!-- Hauptinterface -->
  <div id="mainContainer">
    <div class="container">
      <div class="comic">
        <img src="https://ntc-bot1.netlify.app/Bildschirmfoto%202025-06-26%20um%2021.09.25.png" alt="Linda"/>
        <div class="comic-name">Linda</div>
      </div>
      <div class="chat-area">
        <header>Linda. Deine pers√∂nliche Assistentin im Bereich Personalmanagement.</header>
        <div class="chat-controls">
          <button id="btnSessions" class="control-btn" title="Gespeicherte Chats"><i class="fa-solid fa-list"></i></button>
          <button id="btnNew"      class="control-btn" title="Neuer Chat"><i class="fa-solid fa-plus"></i></button>
          <button id="btnDel"      class="control-btn" title="Chat l√∂schen"><i class="fa-solid fa-trash"></i></button>
        </div>
        <div id="chat"></div>
        <div class="input-bar">
          <button id="tools-btn" title="Tools">‚öôÔ∏è</button>
          <input  id="q" type="text" placeholder="Deine Frage‚Ä¶" autocomplete="off"/>
          <button id="mic-btn" title="Sprich deine Frage ein">üé§</button>
          <button id="send-btn" title="Senden">‚û§</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sessions-Modal -->
  <div class="modal-overlay" id="sessions-modal" style="display:none" onclick="if(event.target===this)hideSessionsModal()">
    <div class="modal-card">
      <div class="modal-head"><i class="fa-solid fa-list"></i>Gespeicherte Chats</div>
      <div class="modal-content" id="sessions-list"></div>
      <div class="modal-footer">
        <button class="modal-btn accept" id="sessions-close">Schlie√üen</button>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    // Elemente
    const privacyModal   = document.getElementById('privacy-modal');
    const usageModal     = document.getElementById('usage-modal');
    const mainContainer  = document.getElementById('mainContainer');
    const sessionsModal  = document.getElementById('sessions-modal');
    const sessionsListEl = document.getElementById('sessions-list');
    const chatEl         = document.getElementById('chat');

    // Storage & Sessions (wie Linda)
    const STORAGE_KEY = 'chat-sessions';
    let sessions = [], activeId = null;
    const initialMsg = {
      role:'assistant',
      content:'Hallo! Wie kann ich Sie im Bereich Personalmanagement, Ausbildung oder Pr√ºfungsvorbereitung unterst√ºtzen?'
    };

    function loadSessions(){
      sessions = JSON.parse(localStorage.getItem(STORAGE_KEY))||[];
    }
    function saveSessions(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(sessions));
    }

    function createSession(){
      const id = Date.now().toString();
      const session = { id, name:'', messages:[initialMsg] };
      sessions.unshift(session); activeId = id; saveSessions(); return session;
    }

    function loadSession(id){
      const s = sessions.find(x=>x.id===id); if(!s) return; activeId=id; messages=s.messages.slice(); renderMessages(); hideSessionsModal();
    }

    function updateSession(){
      const s = sessions.find(x=>x.id===activeId); if(!s) return;
      s.messages = messages.slice();
      const firstUser = s.messages.find(m=>m.role==='user');
      s.name = firstUser ? firstUser.content.substring(0,32) : 'Chat';
      saveSessions(); renderSessionList();
    }

    function deleteSession(id){
      sessions = sessions.filter(x=>x.id!==id);
      if(activeId===id){ if(sessions.length) loadSession(sessions[0].id); else { const s=createSession(); messages=s.messages.slice(); renderMessages(); }}
      saveSessions(); renderSessionList();
    }

    let messages=[];
    function renderMessages(){ chatEl.innerHTML=''; for(const m of messages){ const d=document.createElement('div'); d.className='message '+(m.role==='assistant'?'bot':'user'); d.innerHTML=`<strong>${m.role==='assistant'?'Linda':'Du'}:</strong><br>${marked.parse(m.content)}`; chatEl.appendChild(d);} chatEl.scrollTop=chatEl.scrollHeight; }

    function renderSessionList(){ sessionsListEl.innerHTML=sessions.map(s=>`<div class="session-item" data-id="${s.id}"><span>${s.name||'Chat'}</span><button class="del-session" data-id="${s.id}">üóëÔ∏è</button></div>`).join(''); document.querySelectorAll('.session-item').forEach(el=>el.onclick=()=>loadSession(el.dataset.id)); document.querySelectorAll('.del-session').forEach(btn=>btn.onclick=e=>{e.stopPropagation();deleteSession(btn.dataset.id);})); }

    document.getElementById('acceptPrivacy').onclick=()=>{privacyModal.style.display='none';usageModal.style.display='flex';};
    document.getElementById('acceptUsage').onclick=()=>{usageModal.style.display='none';mainContainer.style.display='flex';loadSessions(); if(!sessions.length){const s=createSession();messages=s.messages.slice();}else{activeId=sessions[0].id;messages=sessions[0].messages.slice();} renderMessages();};
    function showSessionsModal(){renderSessionList();sessionsModal.style.display='flex';}
    function hideSessionsModal(){sessionsModal.style.display='none';}
    document.getElementById('btnSessions').onclick=showSessionsModal;
    document.getElementById('sessions-close').onclick=hideSessionsModal;
    document.getElementById('btnNew').onclick=()=>{if(confirm('Neuen Chat starten?')){const s=createSession();messages=s.messages.slice();renderMessages();}};
    document.getElementById('btnDel').onclick=()=>{if(confirm('Diesen Chat wirklich l√∂schen?')){messages=[];updateSession();renderMessages();}};
    const SpeechRec=window.SpeechRecognition||window.webkitSpeechRecognition;
    if(SpeechRec){const rec=new SpeechRec();rec.lang='de-DE';rec.interimResults=false;rec.maxAlternatives=1;rec.onstart=()=>document.getElementById('mic-btn').classList.add('recording');rec.onend=()=>document.getElementById('mic-btn').classList.remove('recording');rec.onresult=e=>document.getElementById('q').value=e.results[0][0].transcript;document.getElementById('mic-btn').onclick=()=>rec.start();}else{document.getElementById('mic-btn').disabled=true;}
    async function send(){const inp=document.getElementById('q');const text=inp.value.trim();if(!text)return;messages.push({role:'user',content:text});renderMessages();inp.value='';messages.push({role:'assistant',content:'‚è≥ Einen Moment bitte ...'});renderMessages();updateSession();const history=messages.map(m=>({role:m.role,content:m.content}));try{const resp=await fetch('/api/bot',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({question:text,history})});const reply=await resp.text();messages=messages.map(m=>m.role==='assistant'&&m.content.startsWith('‚è≥')?{role:'assistant',content:reply}:m);}catch{messages.push({role:'assistant',content:'‚ùå Es ist ein Fehler aufgetreten.'});}updateSession();renderMessages();}
    document.getElementById('send-btn').onclick=send;
    document.getElementById('q').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey'){e.preventDefault();send();}});
    privacyModal.style.display='flex';
  </script>
</body>
</html>
